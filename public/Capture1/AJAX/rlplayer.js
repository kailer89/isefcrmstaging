/*!
 * Atomi Player - Player's Core Scripts
 * Author: Le Hong Dang <dangle@atomisystems.com>
 * Company: Atomi Systems, Inc.
 * http://www.atomisystems.com
 * Created: 2008/01/20
 * Modified: 2011/08/22
 *
 */
var bSuppressSCORMException=true;$(document).ready(function(){$(window).unload(OnUnload);if(bSendToLMS){scormInitialize()}if(MediaUI.Init){MediaUI.Init()}if(bRequireMediaPlayer){if((Options.UseSilverlight&&Silverlight.isInstalled("2.0")==false)||(Options.UseFlashPlayer&&swfobject.hasFlashPlayerVersion("9.0.31.0")==false)){$(document).bind("reveal.facebox",function(){$(document).unbind("reveal.facebox");$.facebox.showClose(true)});var c=function(){$(document).unbind("close.facebox",c);Prez.Init()};$(document).bind("close.facebox",c);if(Options.UseSilverlight){var a=new Object();a.version="2.0";$.facebox("<p>"+Lang.NeedSilverlight+"</p>"+Silverlight.buildPromptHTML(a))}else{var b=Lang.NeedFlash;b=b.replace("Adobe Flash Player 9",'<a href="http://get.adobe.com/flashplayer">Adobe Flash Player 9</a>');$.facebox("<p>"+b+"</p>")}return}}Prez.Init()});function OnUnload(){if(bSendToLMS){scormTerminate()}}var Prez={INTERVAL:100,PreLoader:null,SlideLoader:null,slideUI:null,prjSlide:null,prjSldUI:null,muted:false,volume:80,Session:{PMode:PlayModes.TUT,User:"",Elapsed:0,savedTime:0,SlideIndex:0,state:States.INITIAL,savedStates:[],RestoreData:{slides:[],index:0}},complete:false,Init:function(){if(TemplateParams.IniVolume!==undefined){this.volume=LimitValue(TemplateParams.IniVolume,0,100);if(this.volume==0){this.muted=true;this.volume=80}}if(!this.prjSlide){var b=this.GetSlides();for(var a=0,c=b.length;a<c;++a){b[a].idx=a}this.prjSlide=b.pop();if(Options.test_max_time){Options.test_max_time*=60000}}UI.InitViewPortSize();this.PreLoad()},Start:function(e,d,a){this.SessionStop();if(e==undefined){e=this.GetInitialPlayMode()}this.ClearAllResults();this.Session.PMode=e;if(this.prjSldUI){this.prjSldUI.CleanUp();this.prjSldUI=null}if(this.slideUI){this.slideUI.CleanUp();this.slideUI=null}this.SessionStart();this.complete=false;if(bSendToLMS){scormStartLesson()}if(d!==undefined){this.Session.RestoreData.index=d}if(this.Session.RestoreData.index===null||this.Session.RestoreData.index===undefined){this.Session.RestoreData.index=0}if(UI.SlideList){UI.SlideList.MarkComplete(false);var c=this.Session.RestoreData.slides;if(c&&c.length){for(var b=0,f=c.length;b<f;++b){if(c[b]){UI.SlideList.MarkComplete(true,b)}}UI.SlideList.MarkComplete(false,this.Session.RestoreData.index)}}this.prjSldUI=new SlideUI(this.prjSlide);if(this.GetSlideCount()<=0){UI.ShowMsg(Lang.NoSlide,true,true);return}this.ShowSlide(this.GetSlideAt(this.Session.RestoreData.index),a?a:0,false)},SessionStart:function(){UI.Init();InitHandlers();this.InitBGTask();this.Session.state=States.RUNNING;this.Session.savedStates.length=0;this.Session.Elapsed=0;this.Session.savedTime=(new Date).getTime();this.Session.SlideIndex=0},SessionStop:function(){RemoveHandlers();this.Session.User="";this.Session.Elapsed=0;this.Session.SlideIndex=0;this.Session.savedStates.length=0;this.Session.state=States.RUNNING;this.ClearAllResults();this.StopBGTask();UI.CleanUp();if(this.SlideLoader){this.SlideLoader.Cancel();this.SlideLoader=null}},Restart:function(b,a){if(!b){b=0}this.ClearAllResults();this.Session.RestoreData.index=b;if(bSendToLMS){scormStoreSuspendData(Prez.Session.RestoreData,true)}this.Start(Prez.Session.PMode,b,a)},IsRunning:function(){return this.Session.state==States.RUNNING},GetState:function(){return this.Session.state},Run:function(a){this.Session.savedStates.length=0;this.Session.state=States.RUNNING;EffectMan.Resume();if(this.prjSldUI){this.prjSldUI.Resume()}if(a){if(this.slideUI){this.slideUI.Resume()}}if(UI.Toolbar){UI.Toolbar.SetPause(false)}},Pause:function(a){if(this.Session.state==a){return false}switch(a){case States.WAITING:if(this.Session.state!=States.RUNNING){return false}break;case States.PAUSED:break;default:return false}this.Session.savedStates.push(this.state);this.Session.state=a;EffectMan.Pause(null,a==States.WAITING);if(this.prjSldUI){this.prjSldUI.Pause(a)}if(this.slideUI){this.slideUI.Pause(a)}if(UI.Toolbar){UI.Toolbar.SetPause(true)}return true},Resume:function(){if(this.Session.state!=States.WAITING&&this.Session.state!=States.PAUSED){return}this.Session.state=this.Session.savedStates.pop();if(this.Session.state===undefined){this.Session.state=States.RUNNING}EffectMan.Resume();if(this.prjSldUI){this.prjSldUI.Resume()}if(this.slideUI){this.slideUI.Resume()}if(UI.Toolbar){UI.Toolbar.SetPause(this.Session.state!=States.RUNNING)}},TogglePause:function(){if(this.complete){return}if(this.Session.state!=States.RUNNING){this.Run(true)}else{this.Pause(States.PAUSED)}},GetSlides:function(){return g_arrSlides},GetSlideCount:function(){return this.GetSlides().length},GetSlideAt:function(a){return this.GetSlides()[a]||null},GetSlide:function(a){var c=this.GetSlides();for(var b=0;b<c.length;++b){if(c[b].id==a){return c[b]}}return null},ShowSlide:function(a,d,b){if(this.complete){this.Restart(a?a.idx:0,d);return}if(b&&this.slideUI&&this.slideUI.slide!=a){if(UI.SlideList){UI.SlideList.MarkComplete(true,this.slideUI.GetIndex())}this.slideUI.GetSubmitedDataObject()}this.Run(false);if(!a){if(!this.slideUI||(this.slideUI.GetIndex()==this.GetSlideCount()-1)){if(this.prjSlide&&UI.Toolbar){UI.Toolbar.SetSliderPosition(this.prjSlide.duration)}this.OnPrezEnd(false)}return}d=d||0;if(!this.slideUI){this.slideUI=new SlideUI(a)}else{if(this.slideUI.slide!==a){this.slideUI.CleanUp();this.slideUI=new SlideUI(a)}}this.slideUI.LoadSubmitedData();this.slideUI.Show(d,function(){});if(UI.Toolbar){UI.Toolbar.SetSliderTip(a.idx+1)}if(this.prjSldUI){var c=a.startTime+d;if(Prez.prjSldUI.ts<0||Math.abs(c-Prez.prjSldUI.ts)>Prez.INTERVAL){Prez.prjSldUI.Show(c)}if(UI.Toolbar){UI.Toolbar.SetSliderPosition(this.prjSldUI.ts)}}Prez.Session.RestoreData.index=this.Session.SlideIndex;if(bSendToLMS){scormStoreSuspendData(Prez.Session.RestoreData,true)}},ShowSlideByIndex:function(a,b){this.ShowSlide(this.GetSlideAt(a),0,b)},ShowSlideByID:function(a,b){this.ShowSlide(this.GetSlide(a),0,b)},HandleSlideLoadingError:function(a){a+="\n"+Lang.ConfirmNextSlide;if(confirm(a)){}},saved:{slide:null,slideTs:0},ShouldDoNextAction:function(){var a=true;if(!this.slideUI||(this.saved.slide!=this.slideUI.slide||this.saved.slideTs>this.slideUI.ts)){a=false;this.saved.slide=null;this.saved.slideTs=0}return a},GetSlideImgUrls:function(h,j,d,e){var c=h.ctrls,k=h.idx;function g(o){switch(o.kind){case CtrlKind.TOGGLE:case CtrlKind.COMBO:if(o.image&&$.inArray(o.image,d)<0){e.push("data/res_"+o.image+".png");d.push(o.image)}break;case CtrlKind.AUDIO:case CtrlKind.VIDEO:break;case CtrlKind.ANSWER:if(o.act){g(o.act)}if(o.note){g(o.note)}break;case CtrlKind.QUIZ:var l=o.ctrls,n;for(var n=0,m=l.length;n<m;++n){g(l[n])}break;default:e.push("data/img_"+k+"."+o.id+".png");break}}if(j){e.push("data/slide_"+k+"."+Options.image_format)}for(var f=0,b=c.length;f<b;++f){g(c[f])}if(h.cursor){var a=h.cursor.cursors;for(var f=0,b=a.length;f<b;++f){if(a[f].img){e.push("data/"+a[f].img)}}}},PreLoad:function(){if(this.PreLoader){this.PreLoader.Cancel();this.PreLoader=null}var j=PrezInfo.ViewPort.width-20,k=24,a,c;if(j>400){j=400}a=Math.floor((PrezInfo.ViewPort.width-j)/2);c=Math.floor((PrezInfo.ViewPort.height-k)/2);$("#PreLoadDiv").remove();UI.Canvas().append('<div id="PreLoadDiv"></div>');$("#PreLoadDiv").css({position:"absolute",width:j+"px",top:c+"px",left:a+"px"}).progressbar().children().text("Loading... 0%");var f=[],g=[],b=this.GetSlides();f=["images/aplogo.png","images/blank.gif","images/loader.gif","images/hover.png","images/button.gif","images/tick.png","images/b.png","images/bl.png","images/br.png","images/tl.png","images/tr.png","images/closelabel.gif"];APToolbar.GetImages(f);f.push("data/"+Params.CC.bgimg);this.GetSlideImgUrls(this.prjSlide,false,g,f);for(var h=0,e=b.length;h<e;++h){this.GetSlideImgUrls(b[h],true,g,f)}var d=f.length;if(!d){this.Start();return}var l={imgs:f,progress:function(n,i){var m=Math.floor((100*n)/i);
$("#PreLoadDiv").progressbar("value",m).children().text("Loading... "+m+"%")},complete:function(){$(Prez).stopTime("startprez");$("#PreLoadDiv").progressbar("value",100).children().text("Loading... 100%");window.setTimeout(function(){$("#PreLoadDiv").progressbar("destroy").remove();if(Prez.Session.state==States.INITIAL){Prez.Start()}},100)}};$(this).oneTime(2*60*1000,"startprez",function(){if(Prez.Session.state==States.INITIAL){$("#PreLoadDiv").progressbar("destroy").remove();Prez.Start()}});this.PreLoader=$.PreLoad(l)},InitBGTask:function(){$(this).everyTime(this.INTERVAL,"BGTask",Prez.OnTimerTick)},StopBGTask:function(){$(this).stopTime("BGTask")},GetInitialPlayMode:function(){if(g_nInitialMode!=undefined){return g_nInitialMode}else{return PlayModes.TUT}},SwitchMode:function(a){if(a!=undefined){Prez.Session.PMode=a}this.LoadSlideByIndex(Prez.Session.SlideIndex);UI.Init()},ToggleClosedCaption:function(){ClosedCaptionUI.ToggleShow()},Close:function(a){if((a)&&(confirm(Lang.ConfirmQuit)==false)){return}window.close()},GoFirst:function(){this.ShowSlideByIndex(0,false)},GoNext:function(){if(this.Session.SlideIndex<this.GetSlideCount()-1){this.ShowSlideByIndex(this.Session.SlideIndex+1,false)}},GoPrev:function(){if(this.Session.SlideIndex>=1){this.ShowSlideByIndex(this.Session.SlideIndex-1,false)}},GoLast:function(){if(this.Session.SlideIndex!=this.GetSlideCount()-1){this.ShowSlideByIndex(this.GetSlideCount()-1,false)}},IsMuted:function(){return this.muted},Mute:function(a){if(a===undefined){a=true}this.muted=a;var b,c;if(this.slideUI){b=this.slideUI.allCtrlUIs;for(c in b){b[c].Mute(a)}}if(this.prjSldUI){b=this.prjSldUI.allCtrlUIs;for(c in b){b[c].Mute(a)}}if(UI.Toolbar){UI.Toolbar.SetMute(a)}},SetVolume:function(a){a=LimitValue(a,0,100);this.volume=a;this.muted=false;var b,c;if(this.slideUI){b=this.slideUI.allCtrlUIs;for(c in b){b[c].SetVolume(a)}}if(this.prjSldUI){b=this.prjSldUI.allCtrlUIs;for(c in b){b[c].SetVolume(a)}}if(UI.Toolbar){UI.Toolbar.SetVolumeValue(a);UI.Toolbar.SetMute(false)}},GetVolume:function(a){if(a&&this.muted){return 0}return this.volume},GetResult:function(){var b=true;switch(Options.pass_condition){case PassCondition.PERCENT:case PassCondition.POINTS:var c=Prez.GetPoints();if(Options.pass_condition==PassCondition.POINTS){b=(c>=Options.pass_value)}else{var a=Prez.GetMaxPoints();if(a>0){b=(parseInt(c*100/a)>=Options.pass_value)}}break;case PassCondition.ANSWERS:b=(Prez.GetTakenInteractionCount(Judge.CORRECT)>=Options.pass_value);break}return b},GetPoints:function(){var e=0;var d=Prez.Session.RestoreData.slides;if(!d){return 0}var g=d.length;for(var c=0;c<g;++c){var f=d[c];if(!f){continue}for(var b in f){var a=f[b];if(!a||!a.p){continue}e+=a.p}}return e},GetMaxPoints:function(){var d,h,b,a,f,g,e,c;d=0;h=Prez.GetSlideCount();for(e=0;e<h;++e){b=Prez.GetSlideAt(e);if(!b){continue}a=b.ctrls;g=a.length||0;for(c=0;c<g;++c){f=a[c];d+=Prez.GetCtrlMaxPoints(f,true)}}return d},GetCtrlMaxPoints:function(b,a){if(!b){return 0}if(a==true){if(b.evt&&(b.evt.mod&EvtMode.SURVEY)){return 0}}if(b.kind==CtrlKind.INPUT){if(b.type==InputUI.KEY){return Prez.GetEvtMaxPoints(b.evt,EvtType.KEY_DOWN)}else{if(b.type==InputUI.MOUSE){return Prez.GetEvtMaxPoints(b.evt,EvtType.CLICK)}else{return 0}}}else{if(b.kind==CtrlKind.TEXTINPUT){return Prez.GetEvtMaxPoints(b.evt,EvtType.TEXT)}else{if(b.kind==CtrlKind.QUIZ){return Prez.GetQuizMaxPoint(b)}}}return 0},GetQuizMaxPoint:function(b){var g=!(b.evt.mod&EvtMode.SURVEY);if(!g){return 0}var h=((b.evt.mod&EvtMode.PARTIAL_SCORE)==EvtMode.PARTIAL_SCORE);var k=0,e;var c=b.ctrls,a=c.length,d,j,f,l;switch(b.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:if(h){for(d=0;d<a;++d){j=c[d];if(!j||j.kind!=CtrlKind.ANSWER||!j.act||!j.act.evt){continue}l=j.act.evt[EvtType.CHECK];if(!l||!l.all){continue}e=l.all.pt||0;if(b.type==QuizUI.Type.MULTI_RESPONSE){if(j.act.checked){k=k+e}}else{if(e>k){k=e}}}}else{k=b.evt.pt}break;case QuizUI.Type.SEQUENCE_DRAGDROP:k=b.evt.pt;break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:for(d=0;d<a;++d){j=c[d];if(j&&j.kind==CtrlKind.TEXTINPUT){k=Prez.GetCtrlMaxPoints(j);break}}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:if(h){for(d=0;d<a;++d){j=c[d];if(!j||j.kind!=CtrlKind.ANSWER||!j.act){continue}k+=Prez.GetCtrlMaxPoints(j.act)}}else{k=b.evt.pt}break}return k},GetEvtMaxPoints:function(c,h,d){if(!c){return 0}if(d==true){if(c&&(c.mod&EvtMode.SURVEY)){return 0}}var b=0;if(c.mod&EvtMode.PARTIAL_SCORE){var a=c[h],f;if(a){for(var e=0,g=a.length;e<g;++e){f=a[e].pt;if(f>b){b=f}}}}else{b=c.pt||0}return b},GetRequirements:function(){switch(Options.pass_condition){case PassCondition.PERCENT:return Lang.RequirePercent.format(Options.pass_value);case PassCondition.POINTS:return Lang.RequirePoints.format(Options.pass_value);case PassCondition.ANSWERS:return Lang.RequireAnswers.format(Options.pass_value)}return Lang.RequireNone},ClearAllResults:function(){Prez.Session.RestoreData.slides=[]},GetInteractionCount:function(){var d,h,b,a,f,g,e,c;d=0;h=Prez.GetSlideCount();for(e=0;e<h;++e){b=Prez.GetSlideAt(e);if(!b){continue}a=b.ctrls;g=a.length||0;for(c=0;c<g;++c){f=a[c];if(!f){continue}if(f.kind==CtrlKind.INPUT){if(f.type!=InputUI.MOUSE_HOVER){d++}}else{if(f.kind==CtrlKind.TEXTINPUT||f.kind==CtrlKind.QUIZ){d++}}}}return d},GetTakenInteractionCount:function(b){var d=0;var f=Prez.Session.RestoreData.slides;if(!f){return 0}var h=f.length;for(var e=0;e<h;++e){var g=f[e];if(!g){continue}for(var c in g){var a=g[c];if(!a||!a.j){continue}if(b==undefined||a.j==b){d++}}}return d},GetTakenSlideCount:function(){var a=0;var c=Prez.Session.RestoreData.slides;if(!c){return 0}var e=c.length;for(var b=0;b<e;++b){var d=c[b];if(d){a++}}return a},GetSlideDuration:function(b){var a=Prez.GetSlideAt(b);if(a){return a.duration?a.duration:-1}return -1},GetDefaultAction:function(){var d=Prez.GetSlideActions();for(var b=0;b<d.length;b++){alert("Nothing here");var c=d[b];for(var a=0;a<c.values.length;a++){if(c.values[a].a!=""){return c.values[a].a}}}return"next:1"},GetSlideActions:function(b){if(b==undefined){b=Prez.Session.SlideIndex}var a=Prez.GetSlideAt(b);if(a!=null){return a.Actions}return null},OnTimerTick:function(){var b=(new Date).getTime();var a=b-Prez.Session.savedTime;switch(Prez.Session.state){case States.RUNNING:case States.WAITING:Prez.Session.Elapsed+=a;Prez.Session.savedTime=b;if(Prez.Session.Elapsed>=Options.test_max_time&&Options.test_max_time&&Prez.Session.PMode==PlayModes.TEST){Prez.StopBGTask();alert(Lang.MaxPrezTimeReached);Prez.OnPrezEnd(true);return}if(Prez.Session.state==States.WAITING){return}break;default:Prez.Session.savedTime=b;return}if(Prez.slideUI){if(Prez.prjSldUI){Prez.prjSldUI.Tick(a);if(UI.Toolbar){UI.Toolbar.SetSliderPosition(Prez.prjSldUI.ts)}}Prez.slideUI.Tick(a);if(Prez.Session.state==States.RUNNING&&Prez.slideUI.IsEnd()){Prez.ShowSlide(Prez.GetSlideAt(Prez.slideUI.GetIndex()+1),0,true)}}},OnPrezEnd:function(a){Prez.complete=true;Prez.StopBGTask();Prez.Pause(States.PAUSED);if(Prez.prjSldUI){Prez.prjSldUI.CleanUp();Prez.prjSldUI=null}if(Prez.slideUI){Prez.slideUI.CleanUp();Prez.slideUI=null}if(bSendToLMS){scormEndLesson(a)}switch(Prez.Session.PMode){case PlayModes.DEMO:if(Options.ConfirmRestart){if(confirm(Lang.EndDemoMsg+Lang.ConfirmRestart)==true){Prez.Restart()}else{Prez.Close(false)}}break;case PlayModes.TUT:if(Options.ConfirmRestart){if(confirm(Lang.EndTutorialMsg+Lang.ConfirmRestart)==true){Prez.Restart()}else{Prez.Close(false)}}break;case PlayModes.PRAC:case PlayModes.TEST:if(Options.ShowReport){Prez.ShowReport()}else{if(Options.report_method!==undefined&&Options.report_method!=ReportMethod.NONE){Prez.SendReport()}}break}},ShowReport:function(){ReportUI.Show()},SendReport:function(){var b=Prez.GetReportData(Options.report_format);if(b===null){return}switch(Options.report_method){case ReportMethod.EMAIL:if(!Options.report_value){Options.report_value=""}var d="mailto:"+encodeURIComponent(Options.report_value)+"?subject="+encodeURIComponent(Lang.Report)+"&body="+encodeURIComponent(b);
try{var f=window.open(d,"_blank");if(f){f.close()}}catch(c){var a=Lang.CouldnotSendReport+Options.report_value;if(c instanceof Error){a+="<br>"+c.name+": "+c.message}else{if(c.toString){a+="<br>"+c.toString()}}a+=Lang.DisablePopupBlocker+"<b><a href='"+d+"' target='_blank'>"+Lang.SendReport+"</a></b>";UI.ShowMsg(a,true,false);return false}Prez.Close(false);break;case ReportMethod.HTTP:try{var e={type:"POST",url:Options.report_value,data:"report="+b,timeout:60000,success:function(){UI.ShowMsg(Lang.SuccessSendReport,true,true)},error:function(g,i,h){if(h){throw h}else{throw new Error(Lang.CouldnotSendReport+Options.report_value+(i?(": "+i):""))}}};UI.ShowMsg(Lang.SendingReport,false,false);$.ajax(e)}catch(c){var a;if(c instanceof Error){a=c.name+": "+c.message}else{if(c.toString){a=c.toString()}else{a=Lang.CouldnotSendReport+Options.report_value}}UI.ShowMsg(a,true,false);return false}break;default:Prez.Close(false);break}},GetReportData:function(l){var e,a,g,p;var n="";var c="\n";var k="\t";var f=": ";var h=new Date();var j=Prez.GetPoints();var b=Prez.GetMaxPoints();var m=$.cookie("userid")||"";while(m==""){m=prompt(Lang.EnterUserID,"")}if(m===null){return null}var o=Math.ceil(Prez.Session.Elapsed/1000);$.cookie("userid",m);switch(l){case ReportFormat.PLAIN:c="\n";f=": ";n=Lang.Presentation+f+PrezInfo.Name+c;n+=Lang.Description+f+PrezInfo.Description+c;n+=Lang.Date1+f+h.toUTCString()+c;n+=Lang.UserID+f+m+c;n+=Lang.TotalTime+f+Math.floor(o/3600)+" h : "+Math.floor((o%3600)/60)+" m : "+(o%60)+" s"+c;n+=Lang.TotalSlides+f+Prez.GetSlideCount()+c;n+=Lang.TakenSlides+f+Prez.GetTakenSlideCount()+c;n+=Lang.TotalInteractions+f+Prez.GetInteractionCount()+c;n+=Lang.TakenInteractions+f+Prez.GetTakenInteractionCount()+c;n+=Lang.CorrectCount+f+Prez.GetTakenInteractionCount(Judge.CORRECT)+c;n+=Lang.Points+f+j+" / "+b+c;n+=Lang.Percentage+f+parseInt(j*100/b)+"%"+c;n+=Lang.Result+f+(Prez.GetResult()?Lang.Passed:Lang.Failed)+" - "+Prez.GetRequirements()+c;n+=c;g=ReportUI.GetReportResult();a=g.length;for(e=0;e<a;++e){p=g[e];n+=(e+1)+". ";n+=Lang.Slide+f+(parseInt(p.slideidx)+1)+", ";n+="ID"+f+p.reportid+", ";n+=Lang.Attempts+f+p.attempts+", ";n+=Lang.Points+f+p.points+", ";n+=Lang.MaxPoints+f+p.maxPoints+", ";n+=Lang.Result+f+p.judge+", ";n+=Lang.InteractionType+f+p.type+", ";n+=Lang.Answer+f+p.answers+c}break;case ReportFormat.CSV:c="\n";f=",";n='"'+Lang.Presentation+'"'+f;n+='"'+Lang.Description+'"'+f;n+='"'+Lang.Date1+'"'+f;n+='"'+Lang.UserID+'"'+f;n+='"'+Lang.TotalTime+'"'+f;n+='"'+Lang.TotalSlides+'"'+f;n+='"'+Lang.TakenSlides+'"'+f;n+='"'+Lang.TotalInteractions+'"'+f;n+='"'+Lang.TakenInteractions+'"'+f;n+='"'+Lang.CorrectCount+'"'+f;n+='"'+Lang.Points+'"'+f;n+='"'+Lang.MaxPoints+'"'+f;n+='"'+Lang.Percentage+'"'+f;n+='"'+Lang.Result+'"'+c;n+='"'+PrezInfo.Name+'"'+f;n+='"'+PrezInfo.Description+'"'+f;n+='"'+h.toUTCString()+'"'+f;n+='"'+m+'"'+f;n+='"'+o+'"'+f;n+='"'+Prez.GetSlideCount()+'"'+f;n+='"'+Prez.GetTakenSlideCount()+'"'+f;n+='"'+Prez.GetInteractionCount()+'"'+f;n+='"'+Prez.GetTakenInteractionCount()+'"'+f;n+='"'+Prez.GetTakenInteractionCount(Judge.CORRECT)+'"'+f;n+='"'+j+'"'+f;n+='"'+b+'"'+f;n+='"'+parseInt(j*100/b)+'"'+f;n+='"'+(Prez.GetResult()?Lang.Passed:Lang.Failed)+'"'+c;n+=c;n+='"#"'+f;n+='"'+Lang.Slide+'"'+f;n+='"ID"'+f;n+='"'+Lang.Attempts+'"'+f;n+='"'+Lang.Points+'"'+f;n+='"'+Lang.MaxPoints+'"'+f;n+='"'+Lang.Result+'"'+f;n+='"'+Lang.InteractionType+'"'+f;n+='"'+Lang.Answer+'"'+c;g=ReportUI.GetReportResult();a=g.length;for(e=0;e<a;++e){p=g[e];n+='"'+(e+1)+'"'+f;n+='"'+(parseInt(p.slideidx)+1)+'"'+f;n+='"'+p.reportid+'"'+f;n+='"'+p.attempts+'"'+f;n+='"'+p.points+'"'+f;n+='"'+p.maxPoints+'"'+f;n+='"'+p.judge+'"'+f;n+='"'+p.type+'"'+f;n+='"'+p.answers+'"'+c}break;case ReportFormat.XML:n='<?xml version="1.0" encoding="UTF-8"?>'+c;n+="<Content>"+c;n+=k+"<Report>"+c;n+=k+k+"<Name>"+PrezInfo.Name+"</Name>"+c;n+=k+k+"<Description>"+PrezInfo.Description+"</Description>"+c;n+=k+k+"<Date>"+h.toUTCString()+"</Date>"+c;n+=k+k+"<UserID>"+m+"</UserID>"+c;n+=k+k+"<TotalTime>"+o+"</TotalTime>"+c;n+=k+k+"<SlideCount>"+Prez.GetSlideCount()+"</SlideCount>"+c;n+=k+k+"<TakenSlide>"+Prez.GetTakenSlideCount()+"</TakenSlide>"+c;n+=k+k+"<TotalInteraction>"+Prez.GetInteractionCount()+"</TotalInteraction>"+c;n+=k+k+"<TakenInteraction>"+Prez.GetTakenInteractionCount()+"</TakenInteraction>"+c;n+=k+k+"<Correct>"+Prez.GetTakenInteractionCount(Judge.CORRECT)+"</Correct>"+c;n+=k+k+"<Points>"+j+"</Points>"+c;n+=k+k+"<MaxPoints>"+b+"</MaxPoints>"+c;n+=k+k+"<Percent>"+parseInt(j*100/b)+"</Percent>"+c;n+=k+k+"<Result>"+Prez.GetResult()+"</Result>"+c;n+=k+k+"<Details>"+c;g=ReportUI.GetReportResult();a=g.length;for(e=0;e<a;++e){p=g[e];n+=k+k+k+"<Interaction>"+c;n+=k+k+k+k+"<SlideIndex>"+(parseInt(p.slideidx)+1)+"</SlideIndex>"+c;n+=k+k+k+k+"<ReportID>"+p.reportid+"</ReportID>"+c;n+=k+k+k+k+"<Attempts>"+p.attempts+"</Attempts>"+c;n+=k+k+k+k+"<Points>"+p.points+"</Points>"+c;n+=k+k+k+k+"<MaxPoints>"+p.maxPoints+"</MaxPoints>"+c;n+=k+k+k+k+"<Result>"+p.judge+"</Result>"+c;n+=k+k+k+k+"<Type>"+p.type+"</Type>"+c;n+=k+k+k+k+"<Answers>"+p.answers+"</Answers>"+c;n+=k+k+k+"</Interaction>"+c}n+=k+k+"</Details>"+c;n+=k+"</Report>"+c;n+="</Content>"+c;break;case ReportFormat.JSON:n="{"+c;n+=k+'"Name":"'+PrezInfo.Name+'",'+c;n+=k+'"Description":"'+PrezInfo.Description+'",'+c;n+=k+'"Date":"'+h.toUTCString()+'",'+c;n+=k+'"UserID":"'+m+'",'+c;n+=k+'"TotalTime":"'+o+'",'+c;n+=k+'"SlideCount":'+Prez.GetSlideCount()+","+c;n+=k+'"TakenSlide":'+Prez.GetTakenSlideCount()+","+c;n+=k+'"TotalInteraction":'+Prez.GetInteractionCount()+","+c;n+=k+'"TakenInteraction":'+Prez.GetTakenInteractionCount()+","+c;n+=k+'"Correct":'+Prez.GetTakenInteractionCount(Judge.CORRECT)+","+c;n+=k+'"Points":'+j+","+c;n+=k+'"MaxPoints":'+b+","+c;n+=k+'"Percent":"'+parseInt(j*100/b)+'",'+c;n+=k+'"Result":'+Prez.GetResult()+","+c;n+=k+'"Details":['+c;g=ReportUI.GetReportResult();a=g.length;for(e=0;e<a;++e){p=g[e];n+=k+k+"{"+c;n+=k+k+k+'"SlideIndex":'+(parseInt(p.slideidx)+1)+","+c;n+=k+k+k+'"ReportID":"'+p.reportid+'",'+c;n+=k+k+k+'"Attempts":'+p.attempts+","+c;n+=k+k+k+'"Points":'+p.points+","+c;n+=k+k+k+'"MaxPoints":'+p.maxPoints+","+c;n+=k+k+k+'"Result":"'+p.judge+'",'+c;n+=k+k+k+'"Type":"'+p.type+'",'+c;n+=k+k+k+'"Answers":"'+p.answers+'"'+c;if(e==a-1){n+=k+k+"}"+c}else{n+=k+k+"},"+c}}n+=k+"]"+c;n+="}";break}return n},GetImage:function(a){return"data/img_"+this.Session.SlideIndex+"."+a+".png"},GetSlideImage:function(a){return"data/slide_"+a+"."+Options.image_format},GetResource:function(b,a){return"data/res_"+b+"."+a}};EvtMan.StopEvent=function(b){b=$.event.fix(b||window.event||{});b.preventDefault();b.stopPropagation();try{b.originalEvent.keyCode=0}catch(a){}return false};EvtMan.DoActions=function(d,c){var e=d.length;if(e>0){var a=-1;function b(){if(++a<e){var f=d[a];if(c&&(f.type==ActType.CONTINUE||d.type==ActType.SKIP)){c.IgnoreWaiting(true)}EvtMan.DoAction(f,b)}}b()}};EvtMan.DoAction=function(action,fnCb){var ctrlUI;switch(action.type){case ActType.WAIT:Prez.Pause(States.WAITING);break;case ActType.SKIP:case ActType.CONTINUE:Prez.Resume();break;case ActType.END:Prez.OnPrezEnd(false);return;case ActType.SUBMIT:if(!action.dat||action.dat<=0){Prez.slideUI.Submit()}else{ctrlUI=Prez.slideUI.GetCtrlUI(action.dat,true);if(ctrlUI&&ctrlUI.Submit){ctrlUI.Submit()}}break;case ActType.CLEAR_INPUT:if(!action.dat||action.dat<=0){Prez.slideUI.ClearUserInput(true)}else{ctrlUI=Prez.slideUI.GetCtrlUI(action.dat,true);if(ctrlUI&&ctrlUI.ClearUserInput){ctrlUI.ClearUserInput(true)}}break;case ActType.SHOW:ctrlUI=Prez.slideUI.GetCtrlUI(action.dat,true);if(ctrlUI&&ctrlUI.ctrl.duration!=0){if(ctrlUI.ctrl.duration<0){ctrlUI.ctrl.duration=3000}if(fnCb){ctrlUI.SetOnHideCallback(fnCb)}ctrlUI.Show({value:CtrlShowState.SHOWING,ts:0,ctrlTs:0},true);return}break;case ActType.HIDE:ctrlUI=Prez.slideUI.GetCtrlUI(action.dat,true);if(ctrlUI){ctrlUI.Hide(true)}break;case ActType.EMAIL:try{if(!action.dat.fullMail){if(!action.dat.to){action.dat.to=""}var strMail="mailto:"+encodeURIComponent(action.dat.to)+"?";
if(action.dat.subject){strMail+="subject="+encodeURIComponent(action.dat.subject)+"&"}if(action.dat.cc){strMail+="cc="+encodeURIComponent(action.dat.cc)+"&"}if(action.dat.bcc){strMail+="bcc="+encodeURIComponent(action.dat.bcc)+"&"}if(action.dat.body){strMail+="body="+encodeURIComponent(action.dat.body)+"&"}action.dat.fullMail=strMail}var win=window.open(action.dat.fullMail,"_blank");if(win){win.close()}}catch(ex){var strErr=Lang.CouldnotSendMail+action.dat.to;if(ex instanceof Error){strErr+="<br><br>"+ex.name+": "+ex.message}else{if(ex.toString){strErr+="<br><br>"+ex.toString()}}UI.ShowMsg(strErr)}break;case ActType.WEB:try{if(!action.dat.specs){action.dat.specs=""}var nwin=window.open(action.dat.url,encodeURIComponent(action.dat.name),action.dat.specs);if(!nwin){var strMsg=Lang.CouldnotOpenWeb+action.dat.url+Lang.DisablePopupBlocker;strMsg+='<b><a href="'+action.dat.url+'" target="'+action.dat.name+'">'+action.dat.url+"</a></b>";UI.ShowMsg(strMsg)}else{nwin.focus()}}catch(ex){var strErr=Lang.CouldnotOpenWeb+action.dat.url;if(ex instanceof Error){strErr+="<br><br>"+ex.name+": "+ex.message}else{if(ex.toString){strErr+="<br><br>"+ex.toString()}}UI.ShowMsg(strErr)}break;case ActType.SCRIPT:try{eval(action.dat)}catch(ex){var strErr=Lang.CouldnotRunAction+action.dat;if(ex instanceof Error){strErr+="<br><br>"+ex.name+": "+ex.message}else{if(ex.toString){strErr+="<br><br>"+ex.toString()}}UI.ShowMsg(strErr)}break;case ActType.SLIDE_ID:Prez.ShowSlideByID(action.dat,true);return;case ActType.SLIDE_IDX:Prez.ShowSlideByIndex(action.dat,true);return;case ActType.NEXT:Prez.ShowSlideByIndex(Prez.Session.SlideIndex+parseInt(action.dat),true);return;case ActType.PREV:Prez.ShowSlideByIndex(Prez.Session.SlideIndex-parseInt(action.dat),true);return}if(fnCb){fnCb()}};EvtMan.SubmitCode={AUTO:-1,MANUAL:-2};function EvtMan(a){this.evt=a;this.curAtp=0}EvtMan.prototype={constructor:EvtMan,IsEnabled:function(){return !this.timeout&&(this.evt.atp<0||this.evt.atp>this.curAtp||this.evt.atp===undefined)},SetTimeExpired:function(){this.timeout=true},Update:function(){this.timeout=false},GetResponse:function(p,a,j,b,g){var d={jud:Judge.UNEXPECTED,pt:0,acts:[]};if(!b){b=this}if(g===undefined){g=true}var h=!(b.evt.mod&EvtMode.SURVEY);var l=this.evt[p];var o=p==EvtType.TEXT&&a=="";var f=false;switch(p){case EvtType.TEXT:case EvtType.KEY_DOWN:case EvtType.CLICK:if(h){if(!l||!l.length){if(p!=EvtType.TEXT||a==""){d.jud=Judge.CORRECT;d.pt=this.evt.pt;if(g){d.acts=b.GetActions(EvtType.CORRECT)}}else{d.jud=Judge.WRONG;if(g){d.acts=b.GetActions(EvtType.WRONG)}}}else{for(var e=0,c=l.length;e<c;++e){var k=InputUI.CheckEvtValue(p,a,l[e].val,j);if(k==Judge.PARTIAL_CORRECT&&p==EvtType.TEXT){if(this.evt.submit!=EvtMan.SubmitCode.AUTO){k=Judge.WRONG}}if(k!=Judge.WRONG){d.jud=k;if(k==Judge.CORRECT){if(this.evt.mod&EvtMode.PARTIAL_SCORE){d.pt=l[e].pt}else{d.pt=this.evt.pt}if(this.evt.mod&EvtMode.PARTIAL_ACTION){d.acts=l[e].acts}if(g){d.acts=d.acts.concat(b.GetActions(EvtType.CORRECT))}break}}}if(d.jud==Judge.UNEXPECTED||(o&&d.jud==Judge.PARTIAL_CORRECT)){if(o){var m=b.GetActions(EvtType.INCOMPLETE);f=(m.length>0);if(g){d.acts=m}}if(f){d.jud=Judge.INCOMPLETE}else{if(d.jud==Judge.UNEXPECTED){d.jud=Judge.WRONG;if(g){d.acts=b.GetActions(EvtType.WRONG)}}}}}}else{if(o){var m=b.GetActions(EvtType.INCOMPLETE);f=(m.length>0);if(g){d.acts=m}}if(f){d.jud=Judge.INCOMPLETE}else{d.jud=Judge.NEUTRAL;if(g){d.acts=b.GetActions(EvtType.COMPLETE)}}}break}return d},GetPoints:function(e,c){if(e===undefined){return this.evt.pt||0}var a=this.evt[e];if(!a){return 0}if(c===undefined){return(a.all&&a.all.pt)||0}switch(e){case EvtType.TEXT:case EvtType.CLICK:case EvtType.KEY_DOWN:for(var b=0,d=a.length;b<d;++b){if(a[b].val==c){return a[b].pt||0}}return 0;default:return(a[c]&&a[c].pt)||0}},GetMaxPoints:function(f){if(this.evt.ptMax!==undefined){return this.evt.ptMax}var b=0;if(this.evt.mod&EvtMode.PARTIAL_SCORE){var a=this.evt[f],d;if(a){for(var c=0,e=a.length;c<e;++c){d=a[c].pt;if(d>b){b=d}}}}else{b=this.evt.pt||0}return(this.evt.ptMax=b)},GetActions:function(g,d){var b=this.evt[g];if(!b){return[]}if(d===undefined&&g!=EvtType.WRONG){return(b.all&&b.all.acts)||[]}switch(g){case EvtType.WRONG:var e=[];if(d===undefined){d=this.curAtp+1}var c=d==this.evt.atp;if(b[d]){e=b[d].acts}if(d>0){if(b[AtpType.ALL]){e=e.concat(b[AtpType.ALL].acts)}if(!c&&b[AtpType.ALL_BUT_LAST]){e=e.concat(b[AtpType.ALL_BUT_LAST].acts)}if(c&&b[AtpType.LAST]){e=e.concat(b[AtpType.LAST].acts)}if(e.length==0&&b[AtpType.OTHERS]){e=b[AtpType.OTHERS].acts}}return e||[];case EvtType.TEXT:case EvtType.KEY_DOWN:case EvtType.CLICK:for(var a=0,f=b.length;a<f;++a){if(b[a].val===d){return b[a].acts||[]}}return[];default:return(b[d]&&b[d].acts)||[]}},CleanUp:function(){}};function SlideUI(f){this.slide=f;this.isPrjSld=f==Prez.prjSlide;if(this.isPrjSld){this.id="sld_prj"}else{this.id="sld_"+this.slide.idx}this.bgId=this.id+"_bg";this.ts=-1;this.ctrlUIs=[];this.allCtrlUIs={};this.inputUIs=[];this.triggeredUIs=[];this.zoomUI=null;this.CCaption=null;var j=f.ineff;if(j&&!j.inited){EffectMan.InitEffect(j,{t:0,l:0,w:UI.slideW,h:UI.slideH});j.inited=true}var g="";var d=f.ctrls;var a=d.length;for(var e=0;e<a;++e){var c=this.CreateControl(d[e]);if(c){if(!c.IsTriggeredByEvent()){this.ctrlUIs.push(c)}g+=c.GetHTML()}}if(f.cursor){f.cursor.kind=CtrlKind.CURSOR;var h=this.CreateControl(f.cursor);if(h){this.ctrlUIs.push(h);g+=h.GetHTML()}}if(f.ccaption&&(Params.CC.modes&Prez.Session.PMode)){this.CCaption=new SlideCCaptionUI(f.ccaption,this)}if(f.zoomAreas){this.zoomUI=new ZoomUI(f.zoomAreas,this)}$("#"+this.id).remove();$("#"+this.bgId).remove();if(this.isPrjSld){g='<div class="slide" id="'+this.id+'">'+g+"</div>";UI.$Slides.prepend(g)}else{g='<div class="slide" id="'+this.id+'">'+g+"</div>";$("#sld_prj").after(g).before('<img id="'+this.bgId+'" style="display:none;" class="bgimg" src="'+Prez.GetSlideImage(this.slide.idx)+'" width="100%" height="100%" />')}for(var b in this.allCtrlUIs){this.allCtrlUIs[b].OnAttached()}}SlideUI.prototype={constructor:SlideUI,GetDOM:function(){return $("#"+this.id)},GetIndex:function(){return this.slide.idx},CreateControl:function(b,a){if(!b){return null}var d=true;if(!a||b.startTime<0){d=(b.showMode&Prez.Session.PMode)==Prez.Session.PMode}if(!d&&b.kind!=CtrlKind.BUTTON&&b.kind!=CtrlKind.INPUT){return null}var c=null;switch(b.kind){case CtrlKind.TEXTINPUT:c=new TxtInputUI(b,this);break;case CtrlKind.TOGGLE:c=new ToggleUI(b,this);break;case CtrlKind.BUTTON:b.type=InputUI.MOUSE;case CtrlKind.INPUT:c=new InputUI(b,this);break;case CtrlKind.ANSWER:c=new AnswerUI(b,this);break;case CtrlKind.QUIZ:c=new QuizUI(b,this);break;case CtrlKind.AUDIO:case CtrlKind.VIDEO:c=new MediaUI(b,this);break;case CtrlKind.CURSOR:c=new CursorUI(b,this);break;case CtrlKind.FEEDBACK:c=new FeedbackUI(b,this);break;default:c=new CtrlUI(b,this);break}if(c){if(a){c.SetParent(a)}this.allCtrlUIs[c.id]=c}return c},GetDOMCtrlID:function(a){return"ctrl_"+this.slide.idx+"_"+a},GetCtrlUI:function(a,b){if(b){a=this.GetDOMCtrlID(a)}return this.allCtrlUIs[a]},Show:function(c,f){if(!this.isPrjSld){Prez.Session.SlideIndex=this.slide.idx}this.inputUIs.length=0;this.triggeredUIs.length=0;this.ts=c||0;var d=$("#"+this.id),b=$("#"+this.bgId),e=this;if(this.slide.ineff&&this.ts<this.slide.ineff.duration){if(this.isPrjSld){EffectMan.Stop(d[0],false)}else{EffectMan.Stop(b[0],false);EffectMan.Stop(d[0],false);b.before($("#"+this.id+" ~ div"))}this._Update();b.show();d.show();var a={exitEffect:false,secondStream:false,startTime:this.ts};if(!this.isPrjSld){EffectMan.Start(b[0],this.slide.ineff,a)}a.callback=function(){e._OnShow();if(f){f.call(this)}};EffectMan.Start(d[0],this.slide.ineff,a)}else{if(!this.isPrjSld){EffectMan.Stop(b[0],true,false);b.before($("#"+this.id+" ~ div"));b.show()}EffectMan.Stop(d[0],true,false);d.show();this._Update();this._OnShow();if(f&&d[0]){f.call(d[0])}}},_Update:function(){if(this.zoomUI){this.zoomUI.Update()}else{if(!this.isPrjSld){ZoomUI.Reset()}}for(var a in this.allCtrlUIs){this.allCtrlUIs[a].Update()
}if(this.CCaption){this.CCaption.Update()}else{if(!this.isPrjSld){ClosedCaptionUI.ClearCaption()}}},_OnShow:function(){if(!this.isPrjSld){$(this).oneTime(500,"removeprev",function(){$("#"+this.bgId).prevAll().remove()})}if(UI.$Wmk&&!this.isPrjSld){if(this.slide.wm){UI.$Wmk.show()}else{UI.$Wmk.hide()}}},Pause:function(d){var b,a,c;if(d==States.PAUSED){c=this.triggeredUIs;for(b=0,a=c.length;b<a;++b){c[b].Pause(d)}}c=this.ctrlUIs;for(b=0,a=c.length;b<a;++b){c[b].Pause(d)}if(this.CCaption){this.CCaption.Pause(d)}},Resume:function(){var b,a,c;c=this.triggeredUIs;for(b=0,a=c.length;b<a;++b){c[b].Resume()}c=this.ctrlUIs;for(b=0,a=c.length;b<a;++b){c[b].Resume()}if(this.CCaption){this.CCaption.Resume()}},Tick:function(a){this.ts+=a;if(this.zoomUI){this.zoomUI.Tick()}var b=this.ctrlUIs.length;for(var c=0;c<b;++c){this.ctrlUIs[c].Tick()}if(this.CCaption){this.CCaption.Tick()}},IsEnd:function(){return this.slide.duration<=this.ts},CleanUp:function(){$(this).stopTime();if(!this.isPrjSld){EffectMan.Stop($("#"+this.bgId)[0],true,false);$("#"+this.bgId).prevAll().remove()}EffectMan.Stop($("#"+this.id)[0],true,false);if(this.zoomUI){this.zoomUI.CleanUp()}for(var a in this.allCtrlUIs){this.allCtrlUIs[a].CleanUp()}if(this.CCaption){this.CCaption.CleanUp()}this.ctrlUIs.length=0;this.allCtrlUIs={};this.inputUIs.length=0;this.triggeredUIs.length=0;this.CCaption=null;this.zoomUI=null},Submit:function(){var c,b,a=this.ctrlUIs.length;for(b=0;b<a;++b){c=this.ctrlUIs[b];if(c.showState!=CtrlShowState.HIDE&&c.Submit&&c.evtMan&&c.ctrl.evt.submit!=EvtMan.SubmitCode.AUTO){c.Submit()}}},ClearUserInput:function(a){var d,c,b=this.ctrlUIs.length;for(c=0;c<b;++c){d=this.ctrlUIs[c];if(d.showState!=CtrlShowState.HIDE&&d.ClearUserInput){d.ClearUserInput(a)}}},AddInputUI:function(a){if($.inArray(a,this.inputUIs)==-1){this.inputUIs.push(a)}},RemoveInputUI:function(b){var a=$.inArray(b,this.inputUIs);if(a>-1){this.inputUIs.splice(a,1)}},AddTriggeredUI:function(a){if($.inArray(a,this.triggeredUIs)==-1){this.triggeredUIs.push(a)}},RemoveTriggeredUI:function(b){var a=$.inArray(b,this.triggeredUIs);if(a>-1){this.triggeredUIs.splice(b,1)}},LoadSubmitedData:function(){var c=Prez.Session.RestoreData.slides;if(!c){return}var d=c[this.slide.idx];if(!d){return}var a=this.ctrlUIs.length;for(var b=0;b<a;++b){this.ctrlUIs[b].LoadSubmitedData(d)}},GetSubmitedDataObject:function(){var a=Prez.Session.RestoreData.slides;if(!a){a=[];Prez.Session.RestoreData.slides=a}var b=a[this.slide.idx];if(!b){b={};a[this.slide.idx]=b}return b}};CtrlUI.GenStyle=function(b,d,c){var a="top:"+b.rect.t+"px;left:"+b.rect.l+"px;width:"+b.rect.w+"px;height:"+b.rect.h+"px;";if(d){if(c===undefined||c===null){c=true}if(c&&UI.IEBLOW){a+="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+d+"');"}else{a+="background:url('"+d+"') no-repeat;"}}return a};CtrlUI.GenCSSRect=function(a){return"top:"+a.t+"px;left:"+a.l+"px;width:"+a.w+"px;height:"+a.h+"px;"};function CtrlUI(c,a){this.ctrl=c;this.parentUI=null;this.slideUI=a;this.id=a.GetDOMCtrlID(c.id);this.ignoreWaiting=false;if(c.fshtml!==undefined){c.html=c.fshtml;c.css=c.fscss;if(Options.zoom_percent!=100){ScaleFont(c,Options.zoom_percent/100)}c.fshtml=undefined;c.fscss=undefined}this.showState=CtrlShowState.HIDE;if(c.evt){this.evtMan=new EvtMan(c.evt)}var d=(c.kind==CtrlKind.QUIZ||c.kind==CtrlKind.ANSWER);var b=c.ineff;if(b){if(!b.inited){EffectMan.InitEffect(b,c.rect,d);b.inited=true}this.endIn=b.duration;if(c.startTime>0){this.endIn+=c.startTime}}b=c.outeff;if(b){if(!b.inited){EffectMan.InitEffect(b,c.rect,d);b.inited=true}if(c.duration<0&&c.startTime<0){c.duration=3000}if(c.duration<0||((c.flags&CtrlFlags.LOOP)&&c.duration>0)){this.startOut=a.slide.duration-b.duration}else{this.startOut=c.duration-b.duration;if(c.startTime>0){this.startOut+=c.startTime}}}}$.extend(CtrlUI.prototype,{constructor:CtrlUI,GetParent:function(){return this.parentUI},SetParent:function(a){this.parentUI=a},GetTopLevel:function(){var b=this,a=this.parentUI;while(a){b=a;a=a.parentUI}return b},IsTopLevel:function(){return !this.parentUI},IsEnabled:function(a){if(this.cleaned){return false}if(!a&&Prez.Session.state==States.PAUSED){return false}if(Prez.Session.PMode&PlayModes.DEMO){return false}if(this.evtMan&&(this.evtMan.evt.mod&EvtMode.INDEPENDENT)){return this.evtMan.IsEnabled()}var b=this.GetTopLevel();if(b.evtMan){return b.evtMan.IsEnabled()}return false},IsTriggeredByEvent:function(){return this.ctrl.startTime<0},GetSlide:function(){return this.slideUI},GetEventMan:function(){return this.evtMan},GetDOM:function(){return $("#"+this.id)},GetLabelHTML:function(c){if(!this.ctrl.html){return""}if(c===undefined||c==1){return'<div id="'+this.id+'_lb" class="label" style="'+CtrlUI.GenCSSRect(this.ctrl.tr)+this.ctrl.css+'">'+this.ctrl.html+"</div>"}var b={t:c*this.ctrl.tr.t,l:c*this.ctrl.tr.l,w:c*this.ctrl.tr.w,h:c*this.ctrl.tr.h},a={html:this.ctrl.html,css:this.ctrl.css};ScaleFont(a,c);return'<div id="'+this.id+'_lb" class="label" style="'+CtrlUI.GenCSSRect(b)+a.css+'">'+a.html+"</div>"},GetHTML:function(){return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(this.ctrl.rect)+'">'+this.GetInnerHTML()+"</div>"},GetInnerHTML:function(){var a;if(UI.IEBLOW){a='<img id="'+this.id+'_bg" class="bgimg" src="'+UI.BlankImgUrl()+'" width="100%" height="100%" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=scale, src=\''+this.GetImg()+"');\" />"}else{a='<img id="'+this.id+'_bg" class="bgimg" src="'+this.GetImg()+'" width="100%" height="100%" />'}var b="";if(this.ctrl.audio&&this.ctrl.kind!=CtrlKind.AUDIO){b='<div id="'+this.id+'_soundctn">'+GetMediaAltHTML()+"</div>"}return b+a+this.GetLabelHTML()},Zoom:function(d){var a=$("#"+this.id)[0];if(!a){return}var b=a.style,c=this.ctrl.rect;if((this.showState!=CtrlShowState.SHOWING||(this.ctrl.ineff.type!=Effect.Type.FLY&&this.ctrl.ineff.type!=Effect.Type.PEEK))&&(this.showState!=CtrlShowState.HIDING||(this.ctrl.outeff.type!=Effect.Type.FLY&&this.ctrl.outeff.type!=Effect.Type.PEEK))){b.top=(d*c.t)+"px";b.left=(d*c.l)+"px"}b.width=(d*c.w)+"px";b.height=(d*c.h)+"px";if(this.ctrl.html){$("#"+this.id+"_lb").replaceWith(this.GetLabelHTML(d))}},GetIniProps:function(){return{left:this.ctrl.rect.l,top:this.ctrl.rect.t}},OnAttached:function(){this.iniProps=this.GetIniProps();if(!this.parentUI&&this.ctrl.startTime>=0){if(this.ctrl.duration<0||((this.ctrl.flags&CtrlFlags.LOOP)&&this.ctrl.duration>0)){if(this.startOut!==undefined){this.endTime=this.slideUI.slide.duration}else{this.endTime=-1}}else{this.endTime=this.ctrl.startTime+this.ctrl.duration}}if(this.ctrl.audio&&this.ctrl.kind!=CtrlKind.AUDIO){this.sound=new MediaPlayer({file:"data/res_"+this.ctrl.audio+".mp3"},this.id+"_soundctn",this.id);if(this.ctrl.kind==CtrlKind.BUTTON||(this.ctrl.kind==CtrlKind.INPUT&&this.ctrl.type==InputUI.MOUSE)){this.isClkSound=true}}if(!this.evtMan){return}var a=this._GetHoverTarget(),d=this;var b=this.evtMan.GetActions(EvtType.MOUSE_ENTER);if(b.length){a.mouseenter(function(){if(d.IsEnabled()){EvtMan.DoActions(b)}})}var c=this.evtMan.GetActions(EvtType.MOUSE_LEAVE);if(c.length){a.mouseleave(function(){if(d.IsEnabled()){EvtMan.DoActions(c)}})}},GetShowState:function(a,b){var c=this.ctrl.startTime;b.ctrlTs=a-c;if(a<c){b.value=CtrlShowState.HIDE}else{if(this.endIn&&a<this.endIn){b.value=CtrlShowState.SHOWING;b.ts=b.ctrlTs}else{if(this.startOut!==undefined){if(a<this.startOut){b.value=CtrlShowState.SHOW}else{if(a<this.endTime){b.value=CtrlShowState.HIDING;b.ts=a-this.startOut}else{b.value=CtrlShowState.HIDE}}}else{if(this.endTime<0||a<this.endTime){b.value=CtrlShowState.SHOW}else{b.value=CtrlShowState.HIDE}}}}},Show:function(e,b){if((this.showState==CtrlShowState.HIDE||b)&&e.value!=CtrlShowState.HIDE){if(this.ctrl.startTime<0){this.slideUI.AddTriggeredUI(this)}$(this).stopTime("hide");if(b&&this.ctrl.duration>=0){var c=this.ctrl.duration;if(this.ctrl.outeff){c-=this.ctrl.outeff.duration}$(this).oneTime(c,"hide",function(){this.Hide(true)
})}$(this).stopTime("timelimit");if(this.evtMan&&!this.parentUI&&this.IsEnabled(true)){var h=this.ctrl.evt.timeLimit;if(h!==undefined&&h>=0){$(this).oneTime(h,"timelimit",function(){this._Timeout()})}}$(this).stopTime("showstart");$(this).oneTime(1,"showstart",function(){this._OnShowStart(e.ctrlTs)})}this.showState=e.value;var g=this,a=$("#"+this.id);var d=a[0];var f={secondStream:this.ctrl.startTime<0,startTime:e.ts};switch(e.value){case CtrlShowState.SHOWING:EffectMan.Stop(d,false);EffectMan.Reset(d,this.iniProps);a.show();f.exitEffect=false;f.callback=function(){g.showState=CtrlShowState.SHOW};EffectMan.Start(d,this.ctrl.ineff,f);break;case CtrlShowState.HIDING:EffectMan.Stop(d,false);EffectMan.Reset(d,this.iniProps);a.show();f.exitEffect=true;f.callback=function(){g._OnHideComplete()};EffectMan.Start(d,this.ctrl.outeff,f);break;case CtrlShowState.HIDE:EffectMan.Stop(d,false);this._OnHideComplete();break;default:EffectMan.Stop(d,false);EffectMan.Reset(d,this.iniProps);a.show();break}},_OnShowStart:function(a){if(this.sound&&!this.isClkSound){if(Prez.GetState()==States.PAUSED){this.sound.Play(false,a/1000);this.soundPaused=true}else{this.sound.Play(true,a/1000)}}},Hide:function(a){$(this).stopTime("hide");if(a&&this.startOut!==undefined&&this.showState!=CtrlShowState.HIDE){if(this.showState==CtrlShowState.HIDING){EffectMan.Resume($("#"+this.id)[0])}else{this.Show({value:CtrlShowState.HIDING,ts:0,ctrlTs:this.startOut},false)}}else{this.Show({value:CtrlShowState.HIDE},false)}},_OnHideComplete:function(){$("#"+this.id).hide();this.showState=CtrlShowState.HIDE;if(this.sound&&!this.isClkSound&&this.ctrl.meddur>this.ctrl.duration){this.sound.SetPlayerReady(false);this.sound.Play(false)}$(this).stopTime("showstart").stopTime("hide").stopTime("timelimit");if(this.ctrl.startTime<0){this.slideUI.RemoveTriggeredUI(this)}var a=this;if(this.onHide){window.setTimeout(function(){if(a.onHide){a.onHideTmp=a.onHide;delete a.onHide;a.onHideTmp();delete a.onHideTmp}},1)}},SetOnHideCallback:function(b){if(!b){return}var a=this.onHide;this.onHide=function(){if(a){a.call(this)}b.call(this)}},Pause:function(a){if(a==States.PAUSED){$(this).pauseTime("timelimit");if(this.sound){this.sound.Play(false);this.soundPaused=true}}$(this).pauseTime("hide")},Resume:function(){$(this).resumeTime("timelimit");$(this).resumeTime("hide");if(this.soundPaused&&this.sound&&this.showState!=CtrlShowState.HIDE){this.sound.Play(true);this.soundPaused=false}},_Timeout:function(){$(this).stopTime("timelimit");if(this.showState!=CtrlShowState.HIDE&&this.IsEnabled()&&this.evtMan){this.evtMan.SetTimeExpired();EvtMan.DoActions(this.evtMan.GetActions(EvtType.TIMEOUT))}},Update:function(){if(this.onHide){delete this.onHide}if(this.evtMan){this.evtMan.Update()}this.ignoreWaiting=false;this.soundPaused=false;if(this.sound&&!this.isClkSound){this.sound.Play(false)}var b={},a=this.slideUI.ts;if(this.ctrl.startTime<0){b.value=CtrlShowState.HIDE}else{if(this.parentUI){b.value=CtrlShowState.SHOW;b.ctrlTs=a-this.ctrl.startTime}else{this.GetShowState(a,b)}}this.showState=CtrlShowState.HIDE;this.Show(b);if(b.value!=CtrlShowState.HIDE){this._WaitIfNeed(true,a)}},Tick:function(){if(this.ctrl.startTime<0){return}var b={},a=this.slideUI.ts;switch(this.showState){case CtrlShowState.SHOWING:this._WaitIfNeed(false,a);break;case CtrlShowState.SHOW:if(!this._WaitIfNeed(false,a)){this.GetShowState(a,b);if(b.value!=this.showState){this.Show(b)}}break;case CtrlShowState.HIDE:this.GetShowState(a,b);if(b.value!=this.showState){this.Show(b);this._WaitIfNeed(false,a)}break}},IgnoreWaiting:function(a){this.ignoreWaiting=a},_WaitIfNeed:function(c,b){if(this.evtMan&&!this.ignoreWaiting&&!this.parentUI&&this.IsEnabled()){var a=this.ctrl.evt.startWait;if(a>=0){a+=this.ctrl.startTime;if(a<=b){if(!c||a==b){this.ignoreWaiting=true;Prez.Pause(States.WAITING);return true}else{if(c){this.ignoreWaiting=true}}}}}return false},CleanUp:function(){$(this).stopTime();$("#"+this.id).stop(true);EffectMan.Stop($("#"+this.id)[0],true,false);if(this.onHide){delete this.onHide}if(this.sound){this.sound.CleanUp()}this._GetHoverTarget().unbind();if(this.evtMan){this.evtMan.CleanUp()}this.cleaned=true},Submit:function(){},LoadSubmitedData:function(){},GetSubmitedDataObject:function(){var b=this.slideUI.GetSubmitedDataObject();var a=b[this.ctrl.id];if(!a){a={};b[this.ctrl.id]=a}return a},GetImg:function(){return"data/img_"+this.slideUI.slide.idx+"."+this.ctrl.id+".png"},_GetHoverTarget:function(){return $("#"+this.id)},_OnPlayerReady:function(){if(this.sound){this.sound.SetPlayerReady(true);$("#"+this.sound.GetId()).css({position:"absolute",top:"-100px",left:"-100px"});this.sound.SetVolume(Prez.GetVolume(true));if(!this.isClkSound){if(this.showState!=CtrlShowState.HIDE){if(Prez.GetState()==States.PAUSED){this.sound.Play(false,this._GetTimeStamp()/1000);this.soundPaused=true}else{this.sound.Play(true,this._GetTimeStamp()/1000)}}else{this.sound.Play(false)}}}},_OnPlayerEnded:function(){},_GetTimeStamp:function(){var a=0;if(this.ctrl.startTime>=0){a=this.slideUI.ts-this.ctrl.startTime;if(a<0){a=0}}return a},Mute:function(a){if(a===undefined){a=true}this.SetVolume(a?0:Prez.GetVolume())},SetVolume:function(a){if(this.sound){this.sound.SetVolume(a)}}});InputUI.MOUSE=1;InputUI.KEY=2;InputUI.MOUSE_HOVER=3;InputUI.GetEvtValue=function(a){var b=0;if(a.ctrlKey){b|=Key.MOD_CTRL}if(a.shiftKey){b|=Key.MOD_SHIFT}if(a.altKey){b|=Key.MOD_ALT}b<<=24;switch(a.apWhich){case Key.CTRL:case Key.SHIFT:case Key.ALT:return b}return(b|a.apWhich)};InputUI.CheckEvtValue=function(h,b,g,a){if(h==EvtType.TEXT){if(!a){b=b.toLowerCase();g=g.toLowerCase()}if(b==g){return Judge.CORRECT}if(g.substr(0,b.length)==b&&b.length<g.length){return Judge.PARTIAL_CORRECT}return Judge.WRONG}if(b==g){return Judge.CORRECT}var c=b&16777215,e=g&16777215,d=b>>24,f=g>>24;if(h==EvtType.KEY_DOWN){if((c==0||c==e)&&(d&f)==d){return Judge.PARTIAL_CORRECT}}else{if(c==0&&(d&f)==d){return Judge.PARTIAL_CORRECT}}return Judge.WRONG};function InputUI(b,a){CtrlUI.call(this,b,a);this.inputId=this.id+"_inp";this.bgId=this.id+"_bg";if(this.ctrl.html){this.labelId=this.id+"_lb"}this.showShape=true;if(this.IsTopLevel()||this.IsTriggeredByEvent()){this.showShape=(this.ctrl.showMode&Prez.Session.PMode)==Prez.Session.PMode}}$.extend(InputUI.prototype,CtrlUI.prototype,{constructor:InputUI,GetInnerHTML:function(){return CtrlUI.prototype.GetInnerHTML.call(this)+'<div tabindex="0" id="'+this.inputId+'" class="evtreceiver"></div>'},OnAttached:function(){var b=$("#"+this.inputId);if(this.showShape){b.css("cursor","pointer")}else{$("#"+this.bgId).css("visibility","hidden");if(this.labelId){$("#"+this.labelId).css("visibility","hidden")}}var a=this;if(this.ctrl.type==InputUI.KEY){b.bind("keydown",function(c){if(!a.IsEnabled()){return}if(c.apWhich===undefined){c.apWhich=Key.ToMozKey(c.which)}if(c.apWhich!=Key.PRTSCR){$(document).trigger("feedback",[c]);a.Submit(EvtType.KEY_DOWN,InputUI.GetEvtValue(c))}return EvtMan.StopEvent(c)}).bind("keyup",function(c){if(!a.IsEnabled()){return}if(c.apWhich===undefined){c.apWhich=Key.ToMozKey(c.which)}if(c.apWhich==Key.PRTSCR){$(document).trigger("feedback",[c]);a.Submit(EvtType.KEY_DOWN,InputUI.GetEvtValue(c))}return EvtMan.StopEvent(c)}).bind("mousedown mouseup",function(c){if(c.type=="mousedown"){Mouse.Norm(c,false);$(document).trigger("feedback",[c])}if(!a.IsEnabled()){return EvtMan.StopEvent(c)}c.stopPropagation()})}else{if(this.ctrl.type==InputUI.MOUSE&&this.ctrl.audio){b.bind("mousedown",function(c){if(a.sound&&a.IsEnabled()&&a.showState!=CtrlShowState.HIDE){a.sound.Play(true,0)}})}}CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);if(Options.FlashABSpeed>0&&this.IsTopLevel()&&this.ctrl.type!=InputUI.MOUSE_HOVER){$(this).stopTime("flashing");$(this).everyTime(Options.FlashABSpeed,"flashing",function(){this._Flashing()})}if(this.IsEnabled(true)){if(this.ctrl.type!=InputUI.MOUSE_HOVER){this.slideUI.AddInputUI(this)}if(this.ctrl.type==InputUI.KEY){this.Focus()
}}},_OnHideComplete:function(){$(this).stopTime("flashing");this.slideUI.RemoveInputUI(this);CtrlUI.prototype._OnHideComplete.call(this)},Pause:function(a){if(a==States.PAUSED){$(this).stopTime("flashing");if(this.showShape){$("#"+this.bgId).css("visibility","visible");if(this.labelId){$("#"+this.labelId).css("visibility","visible")}}}CtrlUI.prototype.Pause.call(this,a)},Resume:function(){if(this.showState!=CtrlShowState.HIDE&&Options.FlashABSpeed&&this.IsTopLevel()&&this.ctrl.type!=InputUI.MOUSE_HOVER){var a=this;$(this).stopTime("flashing");$(this).everyTime(Options.FlashABSpeed,"flashing",function(){a._Flashing()})}CtrlUI.prototype.Resume.call(this)},_Flashing:function(){if(!this.showShape){return}var a=$("#"+this.bgId);if(a.css("visibility")=="hidden"){a.css("visibility","visible");if(this.labelId){$("#"+this.labelId).css("visibility","visible")}}else{a.css("visibility","hidden");if(this.labelId){$("#"+this.labelId).css("visibility","hidden")}}},Submit:function(g,f,c){if(!c){c=this.GetResponse(g,f)}if(c.jud!=Judge.UNEXPECTED&&c.jud!=Judge.PARTIAL_CORRECT){++this.evtMan.curAtp;if(this.ctrl.kind==CtrlKind.INPUT&&this.ctrl.type!=InputUI.MOUSE_HOVER){var b=this.GetSubmitedDataObject();b.v=f;b.a=this.evtMan.curAtp;b.p=c.pt;b.j=c.jud;if(bSendToLMS){try{scormStoreCtrlInteractionData(this,c.jud,c.pt,g,f)}catch(d){if(!bSuppressSCORMException){alert(d.toString())}}}}var a=EvtMan.DoActions(c.acts,this);if(c.jud==Judge.WRONG&&(Prez.Session.PMode&(PlayModes.PRAC|PlayModes.TUT))){this.ShowShape()}CtrlUI.prototype.Submit.call(this);return a}},GetResponse:function(d,b){var a={jud:Judge.UNEXPECTED,pt:0,acts:[]};if(this.showState==CtrlShowState.HIDE||!this.IsEnabled()||this.ctrl.type==InputUI.MOUSE_HOVER){return a}if(d==EvtType.CLICK&&b==Mouse.CLICK_OUTSIDE){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}return a}var c=this.ctrl.type==InputUI.KEY?EvtType.KEY_DOWN:EvtType.CLICK;if(d==c){a=this.evtMan.GetResponse(d,b)}else{if(d==EvtType.KEY_DOWN){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){if(b&16777215){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}else{a=this.evtMan.GetResponse(EvtType.CLICK,b)}}}}return a},Focus:function(){$("#"+this.inputId).focus();this.slideUI.GetDOM().scrollLeft(0).scrollTop(0)},ShowShape:function(){this.showShape=true;$("#"+this.bgId).css("visibility","visible");if(this.labelId){$("#"+this.labelId).css("visibility","visible")}$("#"+this.inputId).css("cursor","pointer")},LoadSubmitedData:function(b){var a=b[this.ctrl.id];if(!a){return}this.evtMan.curAtp=a.a},_GetHoverTarget:function(){return $("#"+this.inputId)},CleanUp:function(){$(this).stopTime("flashing");if(this.showState!=CtrlShowState.HIDE){$("#"+this.inputId).removeClass("evtreceiver")}CtrlUI.prototype.CleanUp.call(this)}});TxtInputUI.PASSWORD=1;TxtInputUI.MULTILINE=2;TxtInputUI.RETAIN=4;TxtInputUI.CASESENS=8;TxtInputUI.LASTCHARTIME=500;function TxtInputUI(b,a){CtrlUI.call(this,b,a);this.inputId=this.id+"_inp";this.inputWrapId=this.inputId+"_wrp";this.labelId=this.id+"_lb";this.inputRc={t:b.tr.t+b.rect.t,l:b.tr.l+b.rect.l,w:b.tr.w,h:b.tr.h};this.inputFontSize=parseFloat($('<div style="'+b.css+'"></div>').css("font-size"));if(isNaN(this.inputFontSize)){this.inputFontSize=12}this.typingText="";this.keydownCode=undefined;this.prevSubmitedText=undefined;this.prevCorrectText=""}$.extend(TxtInputUI.prototype,CtrlUI.prototype,{constructor:TxtInputUI,GetInnerHTML:function(){var b="",a=CtrlUI.GenCSSRect(this.ctrl.tr)+this.ctrl.css;if(this.ctrl.flags&TxtInputUI.MULTILINE){b='<textarea id="'+this.inputId+'" class="edit" style="'+a+'"></textarea>'}else{if(this.ctrl.flags&TxtInputUI.PASSWORD){b='<input id="'+this.inputId+'" type="password" class="edit" style="'+a+'" autocomplete="off" />'}else{b='<input id="'+this.inputId+'" type="text" class="edit" style="'+a+'" autocomplete="off" />'}}return CtrlUI.prototype.GetInnerHTML.call(this)+'<div id="'+this.inputWrapId+'" class="evtreceiver">'+b+"</div>"},OnAttached:function(){if(Prez.Session.PMode==PlayModes.DEMO&&this.IsTopLevel()){var a=this.ctrl.evt[EvtType.TEXT];if(a&&a.length){this.typingText=a[0].val}}if(this.typingText.length){var c=this.ctrl.duration;if(c<0){c=this.slideUI.slide.duration-this.ctrl.startTime}c-=TxtInputUI.LASTCHARTIME;this.typingDelay=0;if(this.ctrl.ineff){this.typingDelay=this.ctrl.ineff.duration;c-=this.typingDelay}if(this.ctrl.outeff){c-=this.ctrl.outeff.duration}this.typingInterval=Math.floor(c/this.typingText.length);this.typingTs=0}var b=$("#"+this.inputWrapId),e=$("#"+this.inputId),d=this;e.focus(function(){$("#"+d.labelId).hide()}).blur(function(){if(!this.value){$("#"+d.labelId).show()}});b.bind("click",function(f){d.Focus()}).bind("mousedown mouseup",function(f){if(f.type=="mousedown"){Mouse.Norm(f,false);$(document).trigger("feedback",[f])}f.stopPropagation()});e.bind("keydown",function(f){if(!d.IsEnabled()){return EvtMan.StopEvent(f)}if(f.apWhich===undefined){f.apWhich=Key.ToMozKey(f.which)}if(f.apWhich!=Key.PRTSCR){$(document).trigger("feedback",[f])}d.keydownCode=InputUI.GetEvtValue(f);if(((d.keydownCode&Key.TAB)==Key.TAB)&&d.keydownCode==d.ctrl.evt.submit){f.preventDefault();d.Submit()}if(f.altKey||f.ctrlKey||(f.apWhich>=Key.F1&&f.apWhich<=Key.F12)){return EvtMan.StopEvent(f)}f.stopPropagation()}).bind("keyup",function(h){if(!d.IsEnabled()){return EvtMan.StopEvent(h)}if(h.apWhich===undefined){h.apWhich=Key.ToMozKey(h.which)}if(h.apWhich==Key.PRTSCR){$(document).trigger("feedback",[h])}var g=d.ctrl.evt.submit;if(g==EvtMan.SubmitCode.AUTO){d.Submit()}else{if(g>0&&((g&Key.TAB)!=Key.TAB)){var f=InputUI.GetEvtValue(h);if(g==d.keydownCode&&(g==f||f==0)){d.Submit()}}}d.keydownCode=undefined;return EvtMan.StopEvent(h)}).bind("mousedown mouseup",function(f){if(f.type=="mousedown"){Mouse.Norm(f,false);$(document).trigger("feedback",[f])}f.stopPropagation()});CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(c){CtrlUI.prototype._OnShowStart.call(this,c);if(this.IsEnabled(true)){this.slideUI.AddInputUI(this);this.Focus()}if(this.typingText!=""){var b=0;if(this.typingTs>=this.typingDelay){if(this.typingInterval>0){b=Math.floor((this.typingTs-this.typingDelay)/this.typingInterval)}else{b=this.typingText.length}}this.SetValue(this.typingText.substr(0,b));if(b<this.typingText.length){$(this).stopTime("typing").everyTime(this.typingInterval,"typing",function(){this._SimulateTyping()})}var a=this.GetValue().length;this.SetSelection(a,a)}},_OnHideComplete:function(){if(this.typingText!=""){$(this).stopTime("typing");this.SetValue(this.typingText)}this.slideUI.RemoveInputUI(this);CtrlUI.prototype._OnHideComplete.call(this)},Update:function(){if(this.typingText!=""){this.typingTs=this.slideUI.ts-this.ctrl.startTime;if(this.typingTs<0){this.typingTs=0}}this.keydownCode=undefined;this.prevSubmitedText=undefined;this.prevCorrectText="";CtrlUI.prototype.Update.call(this)},Pause:function(a){if(this.typingText!=""&&a==States.PAUSED){$(this).pauseTime("typing")}CtrlUI.prototype.Pause.call(this,a)},Resume:function(){if(this.typingText!=""){$(this).resumeTime("typing")}CtrlUI.prototype.Resume.call(this)},Zoom:function(d){var e=$("#"+this.inputId);var a=e[0],b,c;if(a){b=a.style;c=this.ctrl.tr;b.top=(d*c.t)+"px";b.left=(d*c.l)+"px";b.width=(d*c.w)+"px";b.height=(d*c.h)+"px";e.css("font-size",this.inputFontSize*d)}CtrlUI.prototype.Zoom.call(this,d)},Submit:function(f,d,b){if(f===undefined){f=EvtType.TEXT}if(d===undefined){d=this.GetValue()}if(f==EvtType.TEXT&&d==this.prevSubmitedText){return}if(!b){b=this.GetResponse(f,d)}if(b.jud!=Judge.UNEXPECTED&&b.jud!=Judge.PARTIAL_CORRECT){if(b.jud!=Judge.INCOMPLETE){++this.evtMan.curAtp;if(!this.parentUI){var a=this.GetSubmitedDataObject();a.a=this.evtMan.curAtp;a.v=this.GetValue();a.p=b.pt;a.j=b.jud;if(bSendToLMS){try{scormStoreCtrlInteractionData(this,b.jud,b.pt,f,d)}catch(c){if(!bSuppressSCORMException){alert(c.toString())}}}}}if(b.jud==Judge.WRONG&&f==EvtType.TEXT){this.SetSelection(this.prevCorrectText.length,d.length)
}EvtMan.DoActions(b.acts,this);CtrlUI.prototype.Submit.call(this)}if(b.jud!=Judge.UNEXPECTED&&f==EvtType.TEXT){this.prevSubmitedText=d;if(b.jud!=Judge.WRONG){this.prevCorrectText=d}}},SetSelection:function(e,c){var a=$("#"+this.inputId)[0];if(!a){return}this.Focus();try{if(a.createTextRange){var b=a.createTextRange();b.collapse(true);b.moveStart("character",e);b.moveEnd("character",c-e);b.select()}else{if(a.setSelectionRange){a.setSelectionRange(e,c)}else{if(a.selectionStart){a.selectionStart=e;a.selectionEnd=c}}}}catch(d){}},GetResponse:function(c,b){var a={jud:Judge.UNEXPECTED,pt:0,acts:[]};if(this.showState==CtrlShowState.HIDE||!this.IsEnabled()){return a}if(c===undefined){c=EvtType.TEXT}if(b===undefined){b=this.GetValue()}if(c==EvtType.CLICK&&b==Mouse.CLICK_OUTSIDE){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}return a}if(c==EvtType.TEXT){a=this.evtMan.GetResponse(c,b,this.ctrl.flags&TxtInputUI.CASESENS)}else{if(c==EvtType.KEY_DOWN){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}}}return a},ClearUserInput:function(a){if(this.showState==CtrlShowState.HIDE||(a&&!this.IsEnabled())){return}this.SetValue("")},Focus:function(){$("#"+this.inputId).focus();if(UI.IEBrowser){var a=this;window.setTimeout(function(){a.slideUI.GetDOM().scrollLeft(0).scrollTop(0)},0)}else{this.slideUI.GetDOM().scrollLeft(0).scrollTop(0)}},GetValue:function(){return $("#"+this.inputId).val()},SetValue:function(a){$("#"+this.inputId).val(a)},IsCaseSensitive:function(){return this.ctrl.flags&TxtInputUI.CASESENS},LoadSubmitedData:function(b){var a=b[this.ctrl.id];if(!a){return}this.SetValue(a.v);this.evtMan.curAtp=a.a},_GetHoverTarget:function(){return $("#"+this.inputWrapId)},CleanUp:function(){if(this.showState!=CtrlShowState.HIDE){$("#"+this.inputWrapId).removeClass("evtreceiver")}CtrlUI.prototype.CleanUp.call(this)},_SimulateTyping:function(){this.typingTs+=this.typingInterval;if(this.typingTs<this.typingDelay){return}var a;if(this.typingInterval<=0){a=this.typingText.length}else{a=Math.floor((this.typingTs-this.typingDelay)/this.typingInterval);if(a>this.typingText.length){a=this.typingText.length}}if(this.GetValue().length!=a){this.SetValue(this.typingText.substr(0,a));this.SetSelection(a,a)}if(a>=this.typingText.length){$(this).stopTime("typing")}}});AnswerUI.Type={RADIO:1,CHECK:2,TEXT:3,COMBO:4};function AnswerUI(b,a){CtrlUI.call(this,b,a);this.actUI=a.CreateControl(this.ctrl.act,this);this.noteUI=a.CreateControl(this.ctrl.note,this)}$.extend(AnswerUI.prototype,CtrlUI.prototype,{constructor:AnswerUI,GetHTML:function(){var a='<div id="'+this.id+'" class="comctrl">';if(this.noteUI){a+=this.noteUI.GetHTML()}if(this.actUI){a+=this.actUI.GetHTML()}a+="</div>";return a},GetIniProps:function(){return{left:0,top:0}},OnAttached:function(){if(this.actUI&&this.noteUI&&this.actUI.ctrl.kind==CtrlKind.TOGGLE){var b=this.actUI,a=this.noteUI.id;$('<div id="'+a+'_inp" class="evtreceiver"></div>').appendTo($("#"+a)).click(function(){b.Click();return false}).hover(function(){b.Hover(true)},function(){b.Hover(false)}).bind("mousedown mouseup",function(c){c.stopPropagation()}).css("cursor","pointer")}CtrlUI.prototype.OnAttached.call(this)},Zoom:function(a){}});QuizUI.Type={MULTI_CHOICE:1,MULTI_RESPONSE:2,TRUE_FALSE:3,SINGLELINE_TEXT:4,MULTI_SINGLELINE_TEXT:5,MULTILINE_TEXT:6,DROPDOWN:8,MULTI_DROPDOWN:9,SEQUENCE_DRAGDROP:10};function QuizUI(a,n){function e(p,q){var j=CtrlKind.ANSWER,i=undefined;switch(p.type){case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:j=CtrlKind.TEXTINPUT;break;case QuizUI.Type.DROPDOWN:j=CtrlKind.COMBO;break;case QuizUI.Type.SEQUENCE_DRAGDROP:j=CtrlKind.NOTE;i=NoteType.ANSWER;break}return(q.kind==j)&&(i===undefined||q.type==i)}CtrlUI.call(this,a,n);this.html='<div id="'+this.id+'" class="comctrl">';if(this.ctrl.audio){this.html+='<div id="'+this.id+'_soundctn">'+GetMediaAltHTML()+"</div>"}this.ansUIs=[];var d=this.ctrl.type==QuizUI.Type.SEQUENCE_DRAGDROP&&!this.ctrl.ansPos;var h=[];var c,f=this.ctrl.ctrls,b=f.length,l;for(l=0;l<b;++l){c=n.CreateControl(f[l],this);if(c){if(e(this.ctrl,c.ctrl)){this.ansUIs.push(c);if(d){h.push({top:c.ctrl.rect.t,left:c.ctrl.rect.l})}}this.html+=c.GetHTML()}}if(d){h.sort(function(j,i){return(j.top-i.top)||(j.left-i.left)});this.ctrl.ansPos=h;b=this.ansUIs.length;var m=RandomPermutation(b),g,a;for(l=0;l<b;++l){a=this.ansUIs[l].ctrl;a.curOrder=m[l];for(g=0;g<b;++g){if(h[g].top==a.rect.t&&h[g].left==a.rect.l){a.correctOrder=g;break}}}}var k,o;if(this.ctrl.type==QuizUI.Type.SEQUENCE_DRAGDROP){for(l=0,b=this.ansUIs.length;l<b;++l){c=this.ansUIs[l];c.curOrder=c.ctrl.curOrder;k=c.ctrl.rect;o=this.ctrl.ansPos[c.curOrder];k.t=o.top;k.l=o.left}}this.html+="</div>"}$.extend(QuizUI.prototype,CtrlUI.prototype,{constructor:QuizUI,GetHTML:function(){return this.html},GetIniProps:function(){return{left:0,top:0}},OnAttached:function(){var f=this;if(this.ctrl.type==QuizUI.Type.SEQUENCE_DRAGDROP){var a={addClasses:false,cursor:"default",zIndex:ZIndexBase.Dragging,start:function(h,j){f.draggingUI=f.slideUI.GetCtrlUI(this.id,false);if(!f.draggingUI||!f.draggingUI.IsEnabled()){f.draggingUI=null;return false}if(f.draggingUI){var g=f.draggingUI.ctrl.rect;var k={t:g.t*ZoomUI.Scale,l:g.l*ZoomUI.Scale,w:g.w*ZoomUI.Scale,h:g.h*ZoomUI.Scale};var i='<div class="ctrl" id="ctrl_placeholder" style="'+CtrlUI.GenCSSRect(k)+'"></div>';f.draggingUI.holder=$(i).appendTo(f.slideUI.GetDOM())}},stop:function(g,h){if(f.draggingUI){var i=f.ctrl.ansPos[f.draggingUI.curOrder];h.helper.animate({top:i.top*ZoomUI.Scale,left:i.left*ZoomUI.Scale},200,function(){f.draggingUI.holder.remove();delete f.draggingUI.holder;f.draggingUI=null})}},drag:function(l,m){if(!f.draggingUI){return}var k=m.position.left+l.pageX-m.offset.left,h=m.position.top+l.pageY-m.offset.top,j,p;for(j=0,p=f.ansUIs.length;j<p;++j){var o=f.ansUIs[j];if(o==f.draggingUI){continue}var g=o.ctrl.rect;if(IsInside(g.t*ZoomUI.Scale,g.l*ZoomUI.Scale,g.w*ZoomUI.Scale,g.h*ZoomUI.Scale,k,h)){f.draggingUI.holder.css({top:g.t*ZoomUI.Scale,left:g.l*ZoomUI.Scale});f.SortAnswers(f.draggingUI,o);break}}}};if(!$.browser.msie||(parseInt($.browser.version)>=9)){a.opacity=0.8}for(var b=0,e=this.ansUIs.length;b<e;++b){var c=this.ansUIs[b];var d=this.ctrl.ansPos[c.ctrl.curOrder];c.GetDOM().append('<div id="'+c.id+'_inp" class="evtreceiver"></div>').css({top:d.top*ZoomUI.Scale,left:d.left*ZoomUI.Scale}).bind("mousedown",function(g){g.stopPropagation()}).draggable(a)}}CtrlUI.prototype.OnAttached.call(this)},Zoom:function(c){if(this.draggingUI&&this.draggingUI.holder){var a=this.draggingUI.ctrl.rect;var b={top:a.t*ZoomUI.Scale,left:a.l*ZoomUI.Scale,width:a.w*ZoomUI.Scale,height:a.h*ZoomUI.Scale};this.draggingUI.holder.css(b)}},Submit:function(){if(!this.IsEnabled()){return}var q=this.GetSubmitedDataObject();if(!q.v){q.v={}}var k=!(this.ctrl.evt.mod&EvtMode.SURVEY);var n=(k&&((this.ctrl.evt.mod&EvtMode.PARTIAL_SCORE)==EvtMode.PARTIAL_SCORE)),c=(k&&((this.ctrl.evt.mod&EvtMode.PARTIAL_ACTION)==EvtMode.PARTIAL_ACTION)),l=0,d=[],b=false,a,m;var p=0;var h=0,o=this.ansUIs.length;if(!k){m=Judge.NEUTRAL}else{m=Judge.CORRECT}switch(this.ctrl.type){case QuizUI.Type.MULTI_RESPONSE:c=false;case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:for(h=0;h<o;++h){a=this.ansUIs[h].actUI;if(k){if(a.IsChecked()){++l;if(!a.ctrl.checked){m=Judge.WRONG}if(a.evtMan){if(n){p+=a.evtMan.GetPoints(EvtType.CHECK)}if(c){d=a.evtMan.GetActions(EvtType.CHECK)}}}else{if(a.ctrl.checked&&m!=Judge.WRONG){m=Judge.PARTIAL_CORRECT}}}else{if(a.IsChecked()){++l}}q.v[a.ctrl.id]=a.IsChecked()}if(l==0){d=this.evtMan.GetActions(EvtType.INCOMPLETE);if(d.length){m=Judge.INCOMPLETE;b=true}else{if(k){m=Judge.WRONG}else{m=Judge.NEUTRAL}}}else{if(k){if(m==Judge.CORRECT){if(!n){p=this.ctrl.evt.pt}}else{if(this.ctrl.type==QuizUI.Type.MULTI_RESPONSE&&m==Judge.WRONG){p=0;d.length=0}m=Judge.WRONG}}else{m=Judge.NEUTRAL;p=0}}break;case QuizUI.Type.SEQUENCE_DRAGDROP:for(h=0;
h<o;++h){a=this.ansUIs[h];a.ctrl.curOrder=a.curOrder;if(m==Judge.CORRECT){if(a.curOrder!=a.ctrl.correctOrder){m=Judge.WRONG}}q.v[a.ctrl.id]=a.curOrder}if(m==Judge.CORRECT){p=this.ctrl.evt.pt}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:a=this.ansUIs[0];if(a&&a.ctrl.kind==CtrlKind.TEXTINPUT){var g=a.evtMan.GetResponse(EvtType.TEXT,a.GetValue(),a.IsCaseSensitive(),this.evtMan,true);m=g.jud;p=g.pt;d=g.acts;b=true;q.v[a.ctrl.id]=a.GetValue()}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:var f=false,g;for(h=0;h<o;++h){a=this.ansUIs[h].actUI;g=a.evtMan.GetResponse(EvtType.TEXT,a.GetValue(),a.IsCaseSensitive(),this.evtMan,false);if(g.jud==Judge.INCOMPLETE){m=Judge.INCOMPLETE;break}else{if(g.jud==Judge.WRONG){f=true}else{if(g.jud==Judge.CORRECT){p+=g.pt}}}q.v[a.ctrl.id]=a.GetValue()}if(m==Judge.INCOMPLETE){p=0}else{if(k){if(f){m=Judge.WRONG}if(!n){p=m==Judge.WRONG?0:this.ctrl.evt.pt}}else{p=0}}break}if(!b){switch(m){case Judge.INCOMPLETE:d=this.evtMan.GetActions(EvtType.INCOMPLETE);break;case Judge.NEUTRAL:d=this.evtMan.GetActions(EvtType.COMPLETE);break;case Judge.CORRECT:d=d.concat(this.evtMan.GetActions(EvtType.CORRECT));break;case Judge.WRONG:d=d.concat(this.evtMan.GetActions(EvtType.WRONG));break}}if(m!=Judge.INCOMPLETE){++this.evtMan.curAtp}q.a=this.evtMan.curAtp;q.p=p;q.j=m;if(bSendToLMS){try{scormStoreQuizInteractionData(this,m,p)}catch(j){if(!bSuppressSCORMException){alert(j.toString())}}}EvtMan.DoActions(d,this)},ClearUserInput:function(a){if(this.showState==CtrlShowState.HIDE||(a&&!this.IsEnabled())){return}var b=0,c=this.ansUIs.length,d,e;switch(this.ctrl.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:for(b=0;b<c;++b){this.ansUIs[b].actUI.Check(false)}break;case QuizUI.Type.SEQUENCE_DRAGDROP:for(b=0;b<c;++b){d=this.ansUIs[b];d.curOrder=d.ctrl.curOrder;e=this.ctrl.ansPos[d.curOrder];d.GetDOM().css({top:e.top*ZoomUI.Scale,left:e.left*ZoomUI.Scale});d.ctrl.rect.t=e.top;d.ctrl.rect.l=e.left}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:d=this.ansUIs[0];if(d&&d.SetValue){d.SetValue("")}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:for(b=0;b<c;++b){d=this.ansUIs[b].actUI;if(d&&d.SetValue){d.SetValue("")}}break}},RadioChecked:function(c){for(var a=0,d=this.ansUIs.length;a<d;++a){var b=this.ansUIs[a].actUI;if(b!=c&&b.IsChecked&&b.IsChecked()){b.Check(false)}}},SortAnswers:function(b,g){var a,d,h,j,f,c=this.ansUIs.length,k=b.curOrder,e=g.curOrder;for(f=0;f<c;++f){a=this.ansUIs[f];if(a==b){b.curOrder=e;h=this.ctrl.ansPos[e];j=a.ctrl.rect;j.t=h.top;j.l=h.left;continue}d=a.curOrder;if(d>k){--d}if(d>=e){++d}if(d!=a.curOrder){a.curOrder=d;h=this.ctrl.ansPos[d];j=a.ctrl.rect;a.GetDOM().css({top:h.top*ZoomUI.Scale,left:h.left*ZoomUI.Scale});j.t=h.top;j.l=h.left}}},LoadSubmitedData:function(d){var a=d[this.ctrl.id];if(!a){return}if(a.a){this.evtMan.curAtp=a.a}if(!a.v){return}var c,f,g;var b=0,e=this.ansUIs.length;switch(this.ctrl.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:for(b=0;b<e;++b){c=this.ansUIs[b].actUI;f=a.v[c.ctrl.id];if(f!=undefined){c.Check(f)}}break;case QuizUI.Type.SEQUENCE_DRAGDROP:for(b=0;b<e;++b){c=this.ansUIs[b];c.curOrder=a.v[c.ctrl.id];c.ctrl.curOrder=c.curOrder;g=this.ctrl.ansPos[c.curOrder];c.GetDOM().css({top:g.top*ZoomUI.Scale,left:g.left*ZoomUI.Scale});c.ctrl.rect.t=g.top;c.ctrl.rect.l=g.left}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:c=this.ansUIs[0];if(c&&c.ctrl.kind==CtrlKind.TEXTINPUT){f=a.v[c.ctrl.id];if(f!=undefined){c.SetValue(f)}}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:for(b=0;b<e;++b){c=this.ansUIs[b].actUI;f=a.v[c.ctrl.id];if(f!=undefined){c.SetValue(f)}}break}}});ToggleUI.State={COUNT:3,CHECKED:1,HOVERED:2,DISABLED:4,PUSHED:8};function ToggleUI(b,a){CtrlUI.call(this,b,a);this.bgId=this.id+"_bg";this.inputId=this.id+"_inp";this.curState=0}$.extend(ToggleUI.prototype,CtrlUI.prototype,{constructor:ToggleUI,GetHTML:function(){var a;if(UI.IEBLOW){a='<img id="'+this.bgId+'" class="togglebgimg" src="'+UI.BlankImgUrl()+'" width="200%" height="300%" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=scale, src=\''+this.GetImg()+"');\" />"}else{a='<img id="'+this.bgId+'" class="togglebgimg" src="'+this.GetImg()+'" width="200%" height="300%" />'}return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(this.ctrl.rect)+'">'+a+'<div id="'+this.inputId+'" class="evtreceiver"></div></div>'},OnAttached:function(){this.UpdateBGPos();var a=this;$("#"+this.inputId).click(function(b){a.Click();return false}).hover(function(){a.Hover(true)},function(){a.Hover(false)}).bind("mousedown mouseup",function(b){b.stopPropagation()}).css("cursor","pointer");CtrlUI.prototype.OnAttached.call(this)},IsEnabled:function(a){if(this.curState&ToggleUI.State.DISABLED){return false}return CtrlUI.prototype.IsEnabled.call(this,a)},GetImg:function(){return Prez.GetResource(this.ctrl.image,"png")},Check:function(a){if(a){this.curState|=ToggleUI.State.CHECKED}else{this.curState&=~ToggleUI.State.CHECKED}this.UpdateBGPos()},IsChecked:function(){return(this.curState&ToggleUI.State.CHECKED)},Click:function(){if(!this.IsEnabled()){return}if(!this.ctrl.radio){this.curState^=ToggleUI.State.CHECKED;this.UpdateBGPos()}else{if((this.curState&ToggleUI.State.CHECKED)==0){this.curState|=ToggleUI.State.CHECKED;this.UpdateBGPos();var a=this.GetTopLevel();if(a.RadioChecked){a.RadioChecked(this)}}}},Hover:function(a){if(!this.IsEnabled()){return}if(a){this.curState|=ToggleUI.State.HOVERED}else{this.curState&=~ToggleUI.State.HOVERED}this.UpdateBGPos()},UpdateBGPos:function(){var a=0,b=0;if(!(this.curState&ToggleUI.State.CHECKED)){a=-100}if(this.curState&ToggleUI.State.DISABLED){b=2}else{if(this.curState&ToggleUI.State.PUSHED){b=3}else{if(this.curState&ToggleUI.State.HOVERED){b=1}}}if(b>ToggleUI.State.COUNT-1){b=0}if(b!=0){b*=-100}$("#"+this.bgId).css({top:b+"%",left:a+"%"})},CleanUp:function(){var a=$("#"+this.inputId);if(this.showState!=CtrlShowState.HIDE){a.removeClass("evtreceiver")}a.unbind();CtrlUI.prototype.CleanUp.call(this)}});function FeedbackUI(b,a){CtrlUI.call(this,b,a);this.keyH=b.rect.h;this.keySpacing=Math.floor(this.keyH/6);this.mouseW=Math.floor((this.keyH-1)*2/3)+1;this.LMBgPos=-(6*this.keyH+2);this.RMBgPos=-(-this.LMBgPos+this.mouseW+2);this.minTextW=this.keyH-2*b.tr.l;if(this.minTextW<0){this.minTextW=0}this.prevModifiers=0}$.extend(FeedbackUI.prototype,CtrlUI.prototype,{constructor:FeedbackUI,GetHTML:function(){var a='<div id="'+this.id+'" class="feedbackctrl" style="top:'+this.ctrl.rect.t+"px;left:"+this.ctrl.rect.l+'px;">'+this._GetKeyHTML(this.id+"_c","Ctrl")+this._GetKeyHTML(this.id+"_s","Shift")+this._GetKeyHTML(this.id+"_a","Alt")+this._GetKeyHTML(this.id+"_k","A")+this._GetMouseHTML(this.id+"_m")+"</div>";return a},_GetKeyHTML:function(d,c){var a=" url('"+this.GetImg()+"') no-repeat;";var b='<div id="'+d+'" class="ctrl" style="width:'+this.keyH+"px;height:"+this.keyH+'px;top:0px;left:0px;"><div id="'+d+'_l" style="background:'+a+"width:"+this.keyH+'px;height:100%;"></div><div id="'+d+'_r" style="background:top right'+a+'position:absolute;top:0;left:0;width:100%; height:100%;"><div id="'+d+'_text" style="position:absolute;white-space:nowrap;top:'+this.ctrl.tr.t+"px;margin:0px "+this.ctrl.tr.l+"px;"+this.ctrl.css+'">'+c+"</div></div></div>";return b},_GetMouseHTML:function(b){var a='<div id="'+b+'" class="ctrl" style="width:'+this.mouseW+"px;height:"+this.keyH+"px;top:0px;left:0px;background:"+this.LMBgPos+"px 0px url('"+this.GetImg()+"') no-repeat;\"></div>";return a},_SetKey:function(d,c){var a=this.keyH,b=this._GetTextWidth(c);if(b>this.minTextW){a+=(b-this.minTextW)}$("#"+d).width(a);$("#"+d+"_l").width(a-Math.floor(this.keyH/2)+3);$("#"+d+"_text").text(c).width(a-2*this.ctrl.tr.l)},_GetTextWidth:function(c){var a=$('<span style="position:absolute;top:-1000px;left:-1000px;'+this.ctrl.css+'"></span>');var b=a.text(c).appendTo(UI.ViewPort()).width();
a.remove();return b},OnAttached:function(){this._SetKey(this.id+"_c","Ctrl");this._SetKey(this.id+"_s","Shift");this._SetKey(this.id+"_a","Alt");CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);var b=this;$(document).bind("feedback."+this.id,function(d,c){b.SetValue(c)})},_OnHideComplete:function(){$(document).unbind("feedback."+this.id);CtrlUI.prototype._OnHideComplete.call(this)},Zoom:function(e){var c=$("#"+this.id)[0];if(!c){return}var d=$(ZoomUI.GetElement()).position();var a=c.style,b=this.ctrl.rect;a.top=(b.t-d.top)+"px";a.left=(b.l-d.left)+"px"},CleanUp:function(){$(document).unbind("feedback."+this.id);CtrlUI.prototype.CleanUp.call(this)},SetValue:function(c){$(this).stopTime("hidekeys");var f=0,b=0;if(c.ctrlKey){f+=$("#"+this.id+"_c").show().width()+this.keySpacing;b|=Key.MOD_CTRL}else{$("#"+this.id+"_c").hide()}if(c.shiftKey){f+=$("#"+this.id+"_s").css("left",f+"px").show().width()+this.keySpacing;b|=Key.MOD_SHIFT}else{$("#"+this.id+"_s").hide()}if(c.altKey){f+=$("#"+this.id+"_a").css("left",f+"px").show().width()+this.keySpacing;b|=Key.MOD_ALT}else{$("#"+this.id+"_a").hide()}var d=b!=this.prevModifiers;this.prevModifiers=b;var a=c.apWhich;switch(a){case Key.CTRL:case Key.SHIFT:case Key.ALT:$("#"+this.id+"_k").hide();if(d){$("#"+this.id+"_m").hide()}break;case Mouse.Buttons.LEFT:case Mouse.Buttons.DBLEFT:$("#"+this.id+"_k").hide();f+=this.keySpacing;$("#"+this.id+"_m").css({left:f+"px","background-position":this.LMBgPos+"px 0px"}).show();break;case Mouse.Buttons.RIGHT:case Mouse.Buttons.DBRIGHT:$("#"+this.id+"_k").hide();f+=this.keySpacing;$("#"+this.id+"_m").css({left:f+"px","background-position":this.RMBgPos+"px 0px"}).show();break;default:var e;if((Key.NUMBER0<=a&&a<=Key.NUMBER9)||(Key.A<=a&&a<=Key.Z)){e=String.fromCharCode(a)}else{if(Key.NUMPAD0<=a&&a<=Key.NUMPAD9){e="Numpad "+(a-Key.NUMPAD0)}else{if(Key.F1<=a&&a<=Key.F12){e="F"+(a-Key.F1+1)}else{e=KeyNames[a];if(e===undefined){e="Unrecognized"}}}}$("#"+this.id+"_m").hide();this._SetKey(this.id+"_k",e);$("#"+this.id+"_k").css("left",f+"px").show();break}$(this).oneTime(1000,"hidekeys",function(){$("#"+this.id+"_c").hide();$("#"+this.id+"_s").hide();$("#"+this.id+"_a").hide();$("#"+this.id+"_k").hide();$("#"+this.id+"_m").hide();this.prevModifiers=0})}});function GetMediaAltHTML(){return""}function MediaUI(b,a){CtrlUI.call(this,b,a);if(b.kind==CtrlKind.AUDIO){b.rect={t:0,l:0,w:1,h:1};this.resUrl="data/res_"+b.audio+".mp3"}else{if(Options.UseSilverlight==true){this.resUrl="data/res_"+b.video+".asf"}else{this.resUrl="data/res_"+b.video+".flv"}}this.placeHolderID=this.id+"_placeholder";this.player=null}$.extend(MediaUI.prototype,CtrlUI.prototype,{constructor:MediaUI,GetHTML:function(){var a=(this.ctrl.kind==CtrlKind.AUDIO)?this.ctrl.audio:this.ctrl.video;if(!a||a<=0){return""}return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(this.ctrl.rect)+'"><div id="'+this.placeHolderID+'" style="width:100%;height:100%;display:block;">'+GetMediaAltHTML()+"</div></div>"},OnAttached:function(){var b=this.ctrl.rect.h;var a={width:this.ctrl.rect.w,height:b,file:this.resUrl,repeat:(this.ctrl.flags&CtrlFlags.LOOP)?"true":"false"};if(this.ctrl.kind==CtrlKind.VIDEO){a.displayheight=b}this.player=new MediaPlayer(a,this.placeHolderID,this.id);CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(b){CtrlUI.prototype._OnShowStart.call(this,b);if(!this.player){return}var a=Prez.GetState();if(a==States.PAUSED||(a==States.WAITING&&!(this.ctrl.flags&CtrlFlags.NOT_WAIT))){this.player.Play(false,this._GetTimeStamp()/1000);this.playingPaused=true}else{this.player.Play(true,this._GetTimeStamp()/1000)}},_OnHideComplete:function(){if(this.player){this.player.SetPlayerReady(false);this.player.Play(false)}CtrlUI.prototype._OnHideComplete.call(this)},Tick:function(){if(this.ctrl.startTime<0){return}var b={},a=this.slideUI.ts;switch(this.showState){case CtrlShowState.SHOW:this.GetShowState(a,b);if(b.value==CtrlShowState.HIDE&&!this.ended){break}if(b.value!=this.showState){this.Show(b)}break;case CtrlShowState.HIDE:if(!this.ended){this.GetShowState(a,b);if(b.value!=this.showState){this.Show(b)}}break}},Update:function(){this.playingPaused=false;this.ended=false;CtrlUI.prototype.Update.call(this)},Pause:function(a){if(a==States.WAITING&&(this.ctrl.flags&CtrlFlags.NOT_WAIT)){return}if(this.player){this.player.Play(false);this.playingPaused=true}CtrlUI.prototype.Pause.call(this,a)},Resume:function(){if(this.playingPaused&&this.player){this.player.Play(true);CtrlUI.prototype.Resume.call(this);this.playingPaused=false}},Zoom:function(a){if(this.ctrl.kind!=CtrlKind.AUDIO){CtrlUI.prototype.Zoom.call(this,a)}},CleanUp:function(){if(this.player){this.player.CleanUp()}CtrlUI.prototype.CleanUp.call(this)},Mute:function(a){if(a===undefined){a=true}this.SetVolume(a?0:Prez.GetVolume())},SetVolume:function(a){if(this.player){this.player.SetVolume(a)}},_OnPlayerReady:function(){if(this.player){this.player.SetPlayerReady(true);if(this.ctrl.kind==CtrlKind.AUDIO){$("#"+this.id).css({top:"-100px",left:"-100px"})}this.player.SetVolume(Prez.GetVolume(true));if(this.showState!=CtrlShowState.HIDE){var a=Prez.GetState();if(a==States.PAUSED||(a==States.WAITING&&!(this.ctrl.flags&CtrlFlags.NOT_WAIT))){this.player.Play(false,this._GetTimeStamp()/1000);this.playingPaused=true}else{this.player.Play(true,this._GetTimeStamp()/1000)}}else{this.player.Play(false)}}},_OnPlayerEnded:function(){if(this.player&&this.player.IsReady()){if(!(this.ctrl.flags&CtrlFlags.LOOP)){this.Hide(false);this.ended=true}}},_GetTimeStamp:function(){var a=0;if(this.ctrl.startTime>=0){a=this.slideUI.ts-this.ctrl.startTime}if(this.ctrl.flags&CtrlFlags.LOOP){var b=this.ctrl.duration;if(b>0){while(a>=b){a-=b}}}if(a<0){a=0}return a}});CursorUI.State={START:1,MOVING:2,STOP:3};CursorUI.Interval=20;function CursorUI(g,a){CtrlUI.call(this,g,a);this.bgId=this.id+"_bg";this.curIdx=0;if(!g.rect){if(g.cursors[0]){g.rect=g.cursors[0].rect}else{g.rect={t:0,l:0,w:0,h:0}}}this.curCursor=null;this.nextCursor=null;this.cursorTs=0;this.state=CursorUI.State.START;this.timerAnimate=undefined;this.animatePaused=false;this.element=null;this.prevAnimTime=0;this.clkSound=null;this.clicked=false;this.curScale=1;if(g.sounds==undefined){g.sounds="";var f,c,h,e=g.cursors,d=0,b=[];for(c=0,h=e.length;c<h;++c){f=e[c];if(f.sound){d=$.inArray(f.sound,b);if(d<0){b.push(f.sound);f.soundIdx=b.length-1}else{f.soundIdx=d}}}for(c=0,h=b.length;c<h;++c){g.sounds+="data/res_"+b[c]+".mp3";if(c<h-1){g.sounds+=","}}}}$.extend(CursorUI.prototype,CtrlUI.prototype,{constructor:CursorUI,GetHTML:function(){var b="";if(this.ctrl.sounds!=""){b='<div id="'+this.id+'_soundctn">'+GetMediaAltHTML()+"</div>"}var a=this.ctrl.cursors[this.curIdx];if(a){return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(a.rect)+'">'+b+'<img id="'+this.bgId+'" class="bgimg" src="data/'+a.img+'" width="100%" height="100%" /></div>'}else{return'<div id="'+this.id+'" class="ctrl" style="width:1px;height:1px;">'+b+'<img id="'+this.bgId+'" class="bgimg" src="'+UI.BlankImgUrl()+'" width="100%" height="100%" /></div>'}},GetIniProps:function(){return{}},OnAttached:function(){CtrlUI.prototype.OnAttached.call(this);this.element=$("#"+this.id)[0];if(this.ctrl.sounds!=""){this.clkSound=new MediaPlayer({files:this.ctrl.sounds},this.id+"_soundctn",this.id)}},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);if(Prez.GetState()==States.RUNNING){this._StartAnimate()}else{this.animatePaused=true}},_OnHideComplete:function(){this._StopAnimate();CtrlUI.prototype._OnHideComplete.call(this)},Zoom:function(c){this.curScale=c;if(this.curCursor&&this.element){var a=this.element.style,b=this.curCursor.rect;if(this.state!=CursorUI.State.MOVING){a.top=(c*b.t)+"px";a.left=(c*b.l)+"px"}a.width=(c*b.w)+"px";a.height=(c*b.h)+"px"}},Pause:function(a){if(this.timerAnimate!==undefined){this._StopAnimate();this.animatePaused=true}CtrlUI.prototype.Pause.call(this,a);if(a==States.PAUSED&&this.clkSound){this.clkSound.Play(false)
}},Resume:function(){if(this.animatePaused){this._StartAnimate();this.animatePaused=false}CtrlUI.prototype.Resume.call(this)},_StartAnimate:function(){if(this.timerAnimate!==undefined){window.clearInterval(this.timerAnimate)}if(!this.element){return}var a=this;this.timerAnimate=window.setInterval(function(){a._OnInterval()},CursorUI.Interval);this.prevAnimTime=(new Date).getTime()},_StopAnimate:function(){if(this.timerAnimate!==undefined){window.clearInterval(this.timerAnimate);this.timerAnimate=undefined}},Update:function(){if(!this.element){return}this.curIdx=-1;this.curCursor=null;this.nextCursor=null;this.clicked=true;if(this.clkSound){this.clkSound.Play(false)}this._StopAnimate();var e,a,f,b=this.slideUI.ts,d,c=this.ctrl.cursors;for(a=0,f=c.length;a<f;++a){e=c[a];d=e.start+e.move+e.stop;if(b<=d||e.start<0){this.cursorTs=b;this.curIdx=a;this.curCursor=e;this.nextCursor=c[a+1];this._UpdateShape(true);if(b<=e.start||e.start<0){this.state=CursorUI.State.START;this._UpdatePos(e.rect)}else{if(b<(e.start+e.move)){this.state=CursorUI.State.MOVING;this._Move()}else{this.state=CursorUI.State.STOP;this._UpdatePos(this.nextCursor.rect)}}break}b-=d}this.showState=CtrlShowState.HIDE;if(this.curCursor){this.Show({value:CtrlShowState.SHOW,ts:0,ctrlTs:0});if(this.curCursor.sound&&this.clkSound){if(this.cursorTs==this.curCursor.click){this.clkSound.PlayItem(this.curCursor.soundIdx)}else{if(this.cursorTs<this.curCursor.click){this.clicked=false}}}}else{this.Hide(false)}},_UpdateShape:function(b){var d=$("#"+this.bgId)[0],c=this.element.style,e=this.ctrl.cursors,a=this.curIdx,f;while(a>=0){f=e[a];if(f.img){c.width=(this.curScale*f.rect.w)+"px";c.height=(this.curScale*f.rect.h)+"px";if(d){d.src="data/"+f.img}return}if(!b){return}--a}if(d){d.src=UI.BlankImgUrl()}},_UpdatePos:function(a){this.element.style.left=(this.curScale*a.l)+"px";this.element.style.top=(this.curScale*a.t)+"px"},Tick:function(){},_OnInterval:function(){var c=this.curCursor,a=(new Date).getTime();this.cursorTs+=(a-this.prevAnimTime);this.prevAnimTime=a;var b=this.cursorTs;while(c){if(c.sound&&!this.clicked&&c.click<=b&&this.clkSound){this.clkSound.PlayItem(c.soundIdx);this.clicked=true}if(b<=c.start||c.start<0){this.state=CursorUI.State.START;if(c.start<0&&(this.clicked||!c.sound)){this._StopAnimate()}return}if(b<c.start+c.move){this.state=CursorUI.State.MOVING;this._Move();return}b-=(c.start+c.move+c.stop);if(b<0){if(this.state!=CursorUI.State.STOP){this.state=CursorUI.State.STOP;if(this.nextCursor){this._UpdatePos(this.nextCursor.rect)}}return}++this.curIdx;this.curCursor=c=this.nextCursor;this.nextCursor=this.ctrl.cursors[this.curIdx+1];this.cursorTs=b;this.state=CursorUI.State.START;this.clicked=false;if(c){this._UpdateShape(false);this._UpdatePos(c.rect)}}this.Hide(false)},_Move:function(){if(this.nextCursor){var a=$.easing.easeInOutQuad((this.cursorTs-this.curCursor.start)/this.curCursor.move,this.cursorTs-this.curCursor.start,0,1,this.curCursor.move);this.element.style.left=(this.curScale*((1-a)*(1-a)*this.curCursor.pos.l+2*a*(1-a)*this.curCursor.cpos.l+a*a*this.nextCursor.pos.l-this.curCursor.rpos.l))+"px";this.element.style.top=(this.curScale*((1-a)*(1-a)*this.curCursor.pos.t+2*a*(1-a)*this.curCursor.cpos.t+a*a*this.nextCursor.pos.t-this.curCursor.rpos.t))+"px"}},CleanUp:function(){if(this.clkSound){this.clkSound.CleanUp()}this._StopAnimate();CtrlUI.prototype.CleanUp.call(this);this.element=null},_OnPlayerReady:function(){if(this.clkSound){this.clkSound.SetPlayerReady(true);$("#"+this.clkSound.GetId()).css({position:"absolute",top:"-100px",left:"-100px"});this.clkSound.SetVolume(Prez.GetVolume(true))}},SetVolume:function(a){if(this.clkSound){this.clkSound.SetVolume(a)}}});ZoomUI.Scale=1;ZoomUI.GetElement=function(){return UI.$Slides[0]};ZoomUI.Reset=function(){ZoomUI.Scale=1;var b=ZoomUI.GetElement();if(b){var a=b.style;a.top="0px";a.left="0px";a.width="100%";a.height="100%"}};function ZoomUI(b,a){this.slideUI=a;this.element=ZoomUI.GetElement();this.stateTs=0;this.timerAnimate=undefined;this.animatePaused=false;this.activeIndexChanged=true;this.prevAnimTime=0;this.zoomAreas=[];var d,c;for(d=0,c=b.length;d<c;++d){if((b[d].showMode&Prez.Session.PMode)==Prez.Session.PMode){this.zoomAreas.push(b[d])}}this.activeIndex=-1;this.zooming=false;this.startTime=0}ZoomUI.prototype={constructor:ZoomUI,Update:function(){var c=this.slideUI.ts,b=this.zoomAreas;var a=b.length-1;while(a>=0&&b[a].startTime>c){--a}this._SetActiveZoom(a,c)},Pause:function(){if(this.pausedTime===undefined){this.pausedTime=+new Date}},Resume:function(){if(this.pausedTime!==undefined){this.startTime+=(new Date).getTime()-this.pausedTime;this.pausedTime=undefined}},Tick:function(){if(this.zooming){return}var d=this.slideUI.ts,b=this.zoomAreas;var c=b.length,a=this.activeIndex+1;while(a<c&&b[a].startTime<=d){++a}--a;if(a!=this.activeIndex){this._SetActiveZoom(a,d)}},Step:function(){if(this.pausedTime!==undefined){return true}var b=+new Date;if(b>=this.startTime+this.duration){this._DoZoom(this.X,this.Y,this.S);this.zooming=false;return false}else{var c=(b-this.startTime)/this.duration;var e=$.easing.easeInOutQuad(c,c,0,1,1);var a=this.preX+(this.X-this.preX)*e;var f=this.preY+(this.Y-this.preY)*e;var d=this.preS/(1-(1-this.preS/this.S)*e);this._DoZoom(a,f,d)}return true},_DoZoom:function(a,f,c){ZoomUI.Scale=c;if(this.element){var b=this.element.style;b.top=(-f*c)+"px";b.left=(-a*c)+"px";b.width=(100*c)+"%";b.height=(100*c)+"%"}var d,e;if(Prez.prjSldUI){d=Prez.prjSldUI.allCtrlUIs;for(e in d){d[e].Zoom(c)}}d=this.slideUI.allCtrlUIs;for(e in d){d[e].Zoom(c)}},_SetActiveZoom:function(b,a){EffectMan.StopZoom(this);this.activeIndex=b;var d=this.zoomAreas[b-1];if(d){this.preX=d.pos.l;this.preY=d.pos.t;this.preS=d.scale/100}else{this.preX=this.preY=0;this.preS=1}d=this.zoomAreas[b];if(d){this.duration=d.inDuration;this.X=d.pos.l;this.Y=d.pos.t;this.S=d.scale/100;var c=a-d.startTime;if(c>=d.inDuration){this._DoZoom(this.X,this.Y,this.S);this.zooming=false}else{this.startTime=(new Date).getTime()-c;this.zooming=true;if(this.Step()){EffectMan.StartZoom(this)}}}else{this.X=this.Y=0;this.S=1;this._DoZoom(this.X,this.Y,this.S);this.zooming=false}},CleanUp:function(){this.element=null;EffectMan.StopZoom(this);this._DoZoom(0,0,1)}};var ClosedCaptionUI={FSMARGIN:5,MARGIN:5,Init:function(){if(this.inited){return}this.id=UI.IDs.ClosedCaption;this.bgId=this.id+"_bg";this.textId=this.id+"_txt";this.$CCaption=$("#"+this.id);this.show=false;if(TemplateParams.IniCCShow){this.Show(true)}else{this.Show(false)}if(Options.zoom_percent!=100&&this.MARGIN==this.FSMARGIN){this.MARGIN=Math.floor((this.FSMARGIN*Options.zoom_percent)/100)}if(Params.CC.fscss!==undefined){Params.CC.css=Params.CC.fscss;if(Options.zoom_percent!=100){Params.CC.html="";ScaleFont(Params.CC,Options.zoom_percent/100)}delete Params.CC.fscss;delete Params.CC.html}this.$CCaption.empty();this.$CCaption.append('<img id="'+this.bgId+'" class="bgimg" src="data/'+Params.CC.bgimg+'" />');this.$CCaption.append('<div id="'+this.textId+'" style="position:absolute;top:'+this.MARGIN+"px;left:"+this.MARGIN+"px;"+Params.CC.css+'"></div>');this.$Text=$("#"+this.textId);this.ClearCaption();this.inited=true},IsShown:function(){return this.show},Show:function(a){if(a===undefined){a=true}this.show=a;if(a){this.$CCaption.css("display","block")}else{this.$CCaption.css("display","none")}if(UI.Toolbar){UI.Toolbar.SetCCaption(a)}},ToggleShow:function(){this.Show(!this.show)},SetCaption:function(a,b){this.$Text.html(a);this.$Text.css({width:(b.w-2*this.MARGIN)+"px",height:(b.h-2*this.MARGIN)+"px"});this.$CCaption.css({top:b.t+"px",left:b.l+"px",width:b.w+"px",height:b.h+"px",visibility:"visible"})},ClearCaption:function(){this.$CCaption.css("visibility","hidden")}};function SlideCCaptionUI(c,a){this.caption=c;this.slideUI=a;this.nodes=c.nodes;this.curNode=null;this.curIdx=-1;this.curNodeShow=false;if(!c.inited){var b=c.nodes,e=Options.zoom_percent/100,g=(Options.zoom_percent!=100),f,d,h;for(d=0,h=b.length;d<h;++d){f=b[d];
if(f.fshtml!==undefined){f.html=f.fshtml;if(g){f.css="";ScaleFont(f,e)}delete f.fshtml;delete f.css}}c.inited=true}}SlideCCaptionUI.prototype={constructor:SlideCCaptionUI,Update:function(){this.curIdx=-1;this.curNode=null;ClosedCaptionUI.ClearCaption();var c,b,d,a=this.slideUI.ts+Prez.INTERVAL;for(b=0,d=this.nodes.length;b<d;++b){c=this.nodes[b];if((c.startTime+c.duration>=a)&&c.duration!=0){this.curIdx=b;this.curNode=c;this._ShowCurrentNode(c.startTime<a);return}}},Tick:function(){if(!this.curNode){return}var b=this.curNode,a=this.slideUI.ts+Prez.INTERVAL;if(this.curNodeShow){if(b.startTime+b.duration<a){do{++this.curIdx;b=this.nodes[this.curIdx]}while(b&&b.duration==0);this.curNode=b;this._ShowCurrentNode(b&&b.startTime<a)}}else{if(this.curNode.startTime<a){this._ShowCurrentNode(true)}}},Pause:function(a){},Resume:function(){},_ShowCurrentNode:function(a){if(a===undefined){a=true}this.curNodeShow=a;if(a&&this.curNode){ClosedCaptionUI.SetCaption(this.curNode.html,this.curNode.rect)}else{ClosedCaptionUI.ClearCaption()}},CleanUp:function(){}};Effect.Type={NONE:0,FADE:1,FLY:2,PEEK:3,WIPE:4};Effect.Dir={NONE:0,BOTTOM:1,LEFT:2,RIGHT:3,TOP:4,BOTTOM_LEFT:5,BOTTOM_RIGHT:6,TOP_LEFT:7,TOP_RIGHT:8};function Effect(){}Effect.prototype={constructor:Effect,Start:function(b,d,a){a=a||{};this.elem=b;this.callback=a.callback;this.secondStream=a.secondStream;if(!d){if(a.callback){window.setTimeout(function(){a.callback.call(b)},1)}return false}if(a.exitEffect){this.starts=d.ends;this.ends=d.starts;this.mStarts=d.mEnds;this.mEnds=d.mStarts}else{this.starts=d.starts;this.ends=d.ends;this.mStarts=d.mStarts;this.mEnds=d.mEnds}this.duration=d.duration;var c=a.startTime;if(isNaN(c)||c<0){c=0}this.startTime=(new Date).getTime()-c;return this.Step(false,true,true)},Pause:function(){if(this.pausedTime===undefined){this.pausedTime=+new Date}},Resume:function(){if(this.pausedTime!==undefined){this.startTime+=(new Date).getTime()-this.pausedTime;this.pausedTime=undefined}},Step:function(d,g,m){if(this.pausedTime!==undefined&&!d){return true}if(!this.elem){return false}var j,a,n,c,k,f={},b=+new Date;if(d||b>=this.duration+this.startTime){k=this.ends;if(k){for(a in k){f[a]=k[a];if((ZoomUI.Scale!=1)&&(a=="left"||a=="top"||a=="width"||a=="height")){f[a]*=ZoomUI.Scale}}}if(f.opacity==1){f.opacity=""}if(this.mEnds){if(UI.IEBrowser){var h=$(this.elem).attr("style");if(h){$(this.elem).attr("style",h.replace(/clip[^;]+;?/gi,""))}$(this.elem).css(f)}else{f.clip="";$(this.elem).css(f)}}else{$(this.elem).css(f)}if(this.callback&&(g||g===undefined)){if(m){var e=this;window.setTimeout(function(){if(e&&e.callback&&e.elem){e.callback.call(e.elem)}},1)}else{this.callback.call(this.elem)}}return false}else{var l=(b-this.startTime)/this.duration;j=$.easing.easeInOutQuad(l,l,0,1,1);c=this.mStarts;k=this.mEnds;if(c){var i={};for(a in c){n=c[a];i[a]=ZoomUI.Scale*(n+(k[a]-n)*j)}f.clip="rect("+i.t+"px "+(i.l+i.w)+"px "+(i.t+i.h)+"px "+i.l+"px)"}c=this.starts;k=this.ends;if(c){for(a in c){n=c[a];f[a]=n+(k[a]-n)*j;if((ZoomUI.Scale!=1)&&(a=="left"||a=="top"||a=="width"||a=="height")){f[a]*=ZoomUI.Scale}}}$(this.elem).css(f)}return true},CleanUp:function(){this.elem=undefined},_Callback:function(){if(this.callback&&this.elem){this.callback.call(this.elem);this.callback=undefined}}};var EffectMan={INTERVAL:40,effects:[],timerId:undefined,zoomUI:null,StartZoom:function(a){this.zoomUI=a;if(Prez.GetState()!=States.RUNNING){a.Pause()}else{this._CreateTimer()}},StopZoom:function(a){if(this.zoomUI==a){this.zoomUI=null;if(!this.effects.length){this._DeleteTimer()}}},Start:function(b,d,a){var c=new Effect();if(c.Start(b,d,a)){this.effects.push(c);switch(Prez.GetState()){case States.PAUSED:c.Pause();break;case States.WAITING:if(c.secondStream){this._CreateTimer()}else{c.Pause()}break;default:this._CreateTimer();break}}},Stop:function(c,b,e){if(!e){e=false}var d=this.effects;for(var a=d.length-1;a>=0;--a){if(d[a].elem==c){if(b){d[a].Step(true,e)}d[a].CleanUp();d.splice(a,1)}}if(!d.length&&!this.zoomUI){this._DeleteTimer()}},Reset:function(c,b){var a={opacity:""};if(b.top!==undefined){a.top=b.top*ZoomUI.Scale}if(b.left!==undefined){a.left=b.left*ZoomUI.Scale}if(UI.IEBrowser){var d=$(c).attr("style");if(d){$(c).attr("style",d.replace(/clip[^;]+;?/gi,""))}$(c).css(a)}else{a.clip="";$(c).css(a)}},Pause:function(c,e){var d=this.effects;var b=0,f=d.length,a=0;if(c){for(b=0;b<f;++b){if(d[b].elem==c){if(e&&d[b].secondStream){continue}d[b].Pause();++a}}}else{if(this.zoomUI){this.zoomUI.Pause();++a}for(b=0;b<f;++b){if(e&&d[b].secondStream){continue}d[b].Pause();++a}}if(this.zoomUI){++f}if(a==f){this._DeleteTimer()}},Resume:function(c){var d=this.effects,a=false;var b=0,e=d.length;if(c){for(b=0;b<e;++b){if(d[b].elem==c){d[b].Resume();a=true}}}else{if(this.zoomUI){this.zoomUI.Resume();a=true}for(b=0;b<e;++b){d[b].Resume()}if(!a){a=e>0}}if(a){this._CreateTimer()}},CleanUp:function(){if(this.zoomUI){this.zoomUI.CleanUp();this.zoomUI=null}var b=this.effects;for(var a=0,c=b.length;a<c;++a){b[a].CleanUp()}b.length=0;this._DeleteTimer()},InitEffect:function(i,c,d){var g,e,a,f,h,b;switch(i.type){case Effect.Type.FADE:i.starts={opacity:0};i.ends={opacity:1};break;case Effect.Type.FLY:case Effect.Type.PEEK:case Effect.Type.WIPE:if(i.type==Effect.Type.FLY){a=f=0;h=UI.slideW;b=UI.slideH}else{a=c.l;f=c.t;h=a+c.w;b=f+c.h}switch(i.dir){case Effect.Dir.TOP:g=c.l;e=f-c.h;break;case Effect.Dir.BOTTOM:g=c.l;e=b;break;case Effect.Dir.RIGHT:g=h;e=c.t;break;case Effect.Dir.TOP_LEFT:g=a-c.w;e=f-c.h;break;case Effect.Dir.TOP_RIGHT:g=h;e=f-c.h;break;case Effect.Dir.BOTTOM_LEFT:g=a-c.w;e=b;break;case Effect.Dir.BOTTOM_RIGHT:g=h;e=b;break;default:g=a-c.w;e=c.t;break}if(i.type!=Effect.Type.WIPE){if(d){i.ends={left:0,top:0};g-=c.l;e-=c.t}else{i.ends={left:c.l,top:c.t}}i.starts={left:g,top:e};if(i.type==Effect.Type.PEEK){i.mStarts={t:c.t-i.starts.top,l:c.l-i.starts.left,w:c.w,h:c.h};i.mEnds={t:c.t-i.ends.top,l:c.l-i.ends.left,w:c.w,h:c.h}}}else{if(d){i.mStarts={t:e,l:g,w:c.w,h:c.h};i.mEnds={t:c.t,l:c.l,w:c.w,h:c.h}}else{i.mStarts={t:e-c.t,l:g-c.l,w:c.w,h:c.h};i.mEnds={t:0,l:0,w:c.w,h:c.h}}}break}},_Step:function(){if(this.zoomUI&&!this.zoomUI.Step()){this.zoomUI=null}var b=this.effects;for(var a=0;a<b.length;++a){if(!b[a].Step()){b[a].CleanUp();b.splice(a--,1)}}if(!b.length&&!this.zoomUI){this._DeleteTimer()}},_CreateTimer:function(){var a=this;if(!this.timerId){this.timerId=window.setInterval(function(){a._Step()},this.INTERVAL)}},_DeleteTimer:function(){if(this.timerId){window.clearInterval(this.timerId);this.timerId=undefined}}};function InitHandlers(){RemoveHandlers();Key.InitHandlers();Mouse.InitHandlers()}function RemoveHandlers(){Key.RemoveHandlers();Mouse.RemoveHandlers()}var Mouse={CLICK_OUTSIDE:-1,Buttons:{NONE:0,LEFT:1,MIDDLE:2,RIGHT:3,DBLEFT:4,DBRIGHT:5,SCROLLUP:6,SCROLLDOWN:7},DClickDelay:400,clkTimer:undefined,target:null,targetCtrlUI:null,time:undefined,value:undefined,Norm:function(b,a){b.apWhich=b.which;if(a){switch(b.apWhich){case this.Buttons.LEFT:b.apWhich=this.Buttons.DBLEFT;break}}},InitHandlers:function(){$(document).bind("mousedown",Mouse.OnMouseDown);$(document).bind("mouseup",Mouse.OnMouseUp);$(document).bind("contextmenu",EvtMan.StopEvent)},RemoveHandlers:function(){this.CleanUp();$(document).unbind("mousedown",Mouse.OnMouseDown);$(document).unbind("mouseup",Mouse.OnMouseUp);$(document).unbind("contextmenu",EvtMan.StopEvent)},ClickOnSlide:function(a){var b=a.target.id;return b.substr(0,4)=="sld_"||b.substr(0,5)=="ctrl_"||b=="appwmk"||b.substr(0,UI.IDs.ClosedCaption.length)==UI.IDs.ClosedCaption},OnMouseDown:function(a){a.timeStamp=(new Date()).getTime();if((Prez.Session.PMode&PlayModes.DEMO)||Prez.Session.state==States.PAUSED||!Prez.slideUI){Mouse.CleanUp();return EvtMan.StopEvent(a)}if(!Mouse.ClickOnSlide(a)){return}Mouse.Norm(a,false);$(document).trigger("feedback",[a]);if(Mouse.clkTimer===undefined){Mouse.target=a.target;Mouse.targetCtrlUI=null;Mouse.time=a.timeStamp}else{if(a.target!=Mouse.target){Mouse._Submit();Mouse.target=a.target;
Mouse.targetCtrlUI=null;Mouse.time=a.timeStamp}}return EvtMan.StopEvent(a)},OnMouseUp:function(c){c.timeStamp=(new Date()).getTime();if((Prez.Session.PMode&PlayModes.DEMO)||Prez.Session.state==States.PAUSED||!Prez.slideUI){Mouse.CleanUp();return EvtMan.StopEvent(c)}if(!Mouse.target){return EvtMan.StopEvent(c)}if(c.target!=Mouse.target){if(Mouse.clkTimer===undefined){Mouse.target={};Mouse.targetCtrlUI=null;Mouse._Submit()}}else{if(Mouse.clkTimer!==undefined){if(Mouse.targetCtrlUI){Mouse.Norm(c,true);Mouse.value=InputUI.GetEvtValue(c)}Mouse._Submit()}else{Mouse.targetCtrlUI=null;var e=Prez.slideUI.inputUIs,a;var b=e.length;while(b>0){--b;a=e[b].id;if(c.target.id.substr(0,a.length)==a){Mouse.targetCtrlUI=e[b];Mouse.Norm(c,false);Mouse.value=InputUI.GetEvtValue(c);break}}var d=c.timeStamp-Mouse.time;if(d>=Mouse.DClickDelay){Mouse._Submit()}else{Mouse.clkTimer=window.setTimeout(function(){Mouse._Submit()},Mouse.DClickDelay-d)}}}return EvtMan.StopEvent(c)},CleanUp:function(){window.clearTimeout(this.clkTimer);this.target=this.targetCtrlUI=null;this.clkTimer=this.time=this.value=undefined},_Submit:function(){if(this.target){if(this.targetCtrlUI){this.targetCtrlUI.Submit(EvtType.CLICK,this.value)}else{var b=Prez.slideUI.inputUIs;for(var a=0,c=b.length;a<c;++a){b[a].Submit(EvtType.CLICK,this.CLICK_OUTSIDE)}}}this.CleanUp()}};var KeyNames={"2":"Middle Click","8":"Backspace","9":"Tab","12":"Clear","13":"Enter","19":"Pause/Break","20":"Caps Lock","27":"Esc","32":"Space","33":"Page Up","34":"Page Down","35":"End","36":"Home","37":"Left Arrow","38":"Up Arrow","39":"Right Arrow","40":"Down Arrow","44":"Print Screen","45":"Insert","46":"Delete","91":"Left Windows","92":"Right Windows","93":"Windows Menu","106":"Numpad *","107":"+","108":"Separator","109":"-","110":"Numpad .","111":"Numpad /","144":"Num Lock","145":"Scroll Lock","59":";","188":",","190":".","191":"/","192":"`","219":"[","220":"\\","221":"]","222":"'"};var Key={MOD_ALT:1,MOD_CTRL:2,MOD_SHIFT:4,SHIFT:16,CTRL:17,ALT:18,F1:112,F12:123,PRTSCR:44,CANCEL:3,PAUSE:19,TAB:9,NUMBER0:48,NUMBER9:57,A:65,Z:90,NUMPAD0:96,NUMPAD9:105,UseMozKey:false,ToMozKey:function(a){if(a==this.CANCEL){return this.PAUSE}if(this.UseMozKey){return a}if(!this.IE2MOZ){this.IE2MOZ=[{ie:186,moz:59},{ie:187,moz:107},{ie:189,moz:109}]}for(var b=0,c=this.IE2MOZ.length;b<c;++b){if(this.IE2MOZ[b].ie==a){return this.IE2MOZ[b].moz}}return a},InitHandlers:function(){$(document).bind("keydown",Key.OnKeyDown);$(document).bind("keyup",Key.OnKeyUp);window.onhelp=EvtMan.StopEvent;document.onhelp=EvtMan.StopEvent;if($.browser.mozilla||$.browser.opera){this.UseMozKey=true}},RemoveHandlers:function(){$(document).unbind("keydown",Key.OnKeyDown);$(document).unbind("keyup",Key.OnKeyUp);window.onhelp=null;document.onhelp=null},OnKeyDown:function(e){if((Prez.Session.PMode&PlayModes.DEMO)||Prez.Session.state==States.PAUSED||!Prez.slideUI){return EvtMan.StopEvent(e)}if(e.apWhich===undefined){e.apWhich=Key.ToMozKey(e.which)}if(e.apWhich==Key.PRTSCR){return EvtMan.StopEvent(e)}$(document).trigger("feedback",[e]);var d=InputUI.GetEvtValue(e);var g=Prez.slideUI.inputUIs;var h=g.length;if(h==1){g[0].Submit(EvtType.KEY_DOWN,d)}else{if(h>1){var f=0;var b=new Array(h);for(f=0;f<h;++f){b[f]=g[f].GetResponse(EvtType.KEY_DOWN,d)}var c=true;for(f=0;f<h;++f){var a=b[f].jud;if(a==Judge.CORRECT||a==Judge.NEUTRAL){g[f].Submit(EvtType.KEY_DOWN,d,b[f]);c=false;break}if(a==Judge.PARTIAL_CORRECT){c=true}}if(c){for(f=0;f<h;++f){if(b[f].jud==Judge.WRONG){if(g[f].Submit(EvtType.KEY_DOWN,d,b[f])===false){break}}}}}}return EvtMan.StopEvent(e)},OnKeyUp:function(){}};var Overlay={nID:0,Show:function(){Prez.Pause(States.WAITING);++this.nID;var a="Overlay_"+this.nID;$('<div class="slideOverlay" id="'+a+'"></div>').appendTo(UI.Canvas()).click(function(){Prez.Resume();$(this).unbind("click").remove()});return a},Hide:function(a){$("#"+a).click()}};
/*!
 * Atomi Ajax Player - UI Implementations
 * Author: Le Hong Dang <dangle@atomisystems.com>
 * Company: Atomi Systems, Inc.
 * http://www.atomisystems.com
 * Created: 2008/01/20
 * Modified: 2011/08/22
 */
var SlideListPos={TOP:0,LEFT:1,RIGHT:2,BOTTOM:3,NONE:4};var UI={IDs:{ViewPort:"ViewPortDiv",Stage:"StageDiv",Canvas:"CanvasDiv",SlideList:"SlideListDiv",ClosedCaption:"CCaptionDiv",Slides:"SlidesDiv"},IEBrowser:false,IEBLOW:false,SlideList:null,Toolbar:null,$Slides:null,slideW:0,slideH:0,BlankImgUrl:function(){return"images/blank.gif"},ViewPort:function(){return $("#"+this.IDs.ViewPort)},Stage:function(){return $("#"+this.IDs.Stage)},Canvas:function(){return $("#"+this.IDs.Canvas)},SlidesPanel:function(){return $("#"+this.IDs.SlideList)},InitViewPortSize:function(){UI.Toolbar=new APToolbar({sliderMin:0,sliderMax:Prez.prjSlide.duration,sliderVal:0});UI.Toolbar.Layout()},Init:function(){UI.IEBrowser=$.browser.msie;UI.IEBLOW=(UI.IEBrowser&&(parseInt($.browser.version)<=7));$(window).unbind("resize").resize(this.OnResizeWindow);this.$Slides=$("#"+this.IDs.Slides).empty();UI.slideW=PrezInfo.ViewPort.width;UI.slideH=PrezInfo.ViewPort.height;var a="da";a+="ta";a+=":i";a+="ma";a+="ge";a+="/p";a+="ng";a+=";b";a+="as";a+="e6";a+="4,";var b='<img id="appwmk" class="bgimg" style="display:none;"src="'+a+Prez.prjSlide.wmd+'" width="100%" height="100%" />';$(b).error(function(){$("#appwmk").remove()}).appendTo(this.$Slides);this.$Wmk=$("#appwmk");ClosedCaptionUI.Init();UI.Toolbar.Show();UI.Toolbar.SetListener("onSeeking",UI,"OnSeeking");UI.Toolbar.SetListener("onVolumeChanging",UI,"OnVolumeChanging");if(TemplateParams.SlideListPos!=SlideListPos.NONE&&!this.SlideList){this.SlideList=new SlideListUI();this.SlideList.Show()}UI.Toolbar.Layout()},OnResizeWindow:function(){UI.Toolbar.Layout()},CleanUp:function(){$(window).unbind("resize")},ToggleSlideList:function(){if(UI.SlideList&&(Prez.Session.PMode==PlayModes.DEMO||Prez.Session.PMode==PlayModes.TUT)){UI.SlideList.ToggleDock()}},OnSeeking:function(f,c,b){if((Prez.Session.PMode==PlayModes.PRAC)||(Prez.Session.PMode==PlayModes.TEST)){return false}var d,a,e=Prez.GetSlides();for(d=e.length-1;d>=0;--d){a=e[d];if(b>=a.startTime){Prez.ShowSlide(a,b-a.startTime,false);return}}},OnVolumeChanging:function(c,b,a){Prez.SetVolume(a)},ShowMsg:function(a,e,b){if(e==undefined){e=true}if(b==undefined){b=false}var d=Prez.Pause(States.WAITING);$(document).bind("reveal.facebox",function(){$(document).unbind("reveal.facebox");$.facebox.showClose(e)});var c=function(){$(document).unbind("close.facebox",c);if(b==true){Prez.Close(false)}else{if(d){Prez.Resume()}}};$(document).bind("close.facebox",c);$.facebox(a)},ShowAbout:function(){var a="";if(PrezInfo.Homepage!=""){a="<a href='"+PrezInfo.Homepage.quoteHTML()+"' target='_blank'>"+PrezInfo.Homepage.quoteHTML()+"</a>"}var b="<div style='font-family:verdana;font-size:90%;color:green'>";b+="<b>"+PrezInfo.Name.quoteHTML()+"</b><br>"+Lang.Author+": <b>"+PrezInfo.Author.quoteHTML()+"</b><br>"+Lang.Copyright+": <b>"+PrezInfo.Copyright.quoteHTML()+"</b><br>"+Lang.Homepage+": <b>"+a+"</b><hr/>"+Lang.BuiltWith+"<br><img id='aplogo' src='images/blank.gif'/><b>"+Params.Generator.quoteHTML()+"</b><br><a href='"+PrezInfo.AppHomePage+"' title='"+PrezInfo.AppHomePage+"' target='_blank'>Atomi Systems, Inc.</a></div>";UI.ShowMsg(b)}};SlideListUI=function(c){this.opts={id:"Slides",title:Lang.Slides,titleheight:18,top:0,left:0,width:400,height:300,zindex:ZIndexBase.SlideList,borderw:2,bordercolor:"#ccc",bgcolor:"#FFFFE1",fgcolor:"black",titlebgcolor:"#0A246A",titlefgcolor:"white"};$.extend(this.opts,c);this.Content="";if(TemplateParams.IniSlideListShow){this.minimized=false}else{this.minimized=true}this.MinSize={w:0,h:0};for(var d=0;d<g_arrSlides.length;d++){var a=g_arrSlides[d];var b=a.name;if(b==""){b="Slide "+(d+1)}this.Content+="<div id='slide_"+d+"' style='display:block'>";this.Content+=(d+1)+". <img id='slidemark_"+d+"' style='display:inline' src='images/blank.gif'></img>";this.Content+="<a href='javascript:Prez.ShowSlideByIndex("+d+", false);' title='Jump to slide: ("+(d+1)+": "+b.quoteHTML()+")'>"+b.quoteHTML()+"</a></div>"
}this.GetHTML=function(){var f="";var h;var i;var g="";var e="";h='<div id="'+this.opts.id+'" style="display:block;overflow: hidden;position: absolute;top:'+this.opts.top+"px;left:"+this.opts.left+"px;width:"+this.opts.width+"px;height:"+this.opts.height+"px;border:"+this.opts.borderw+"px solid "+this.opts.bordercolor+";background-color:"+this.opts.bgcolor+";"+((this.opts.zindex)?("z-index:"+this.opts.zindex):(""))+'">';i="</div>";g="<div id='"+this.opts.id+"Top' style='display:block;position:relative;overflow:hidden;right:0px;top:0px;left:0px;height:"+this.opts.titleheight+"px;background-color:"+this.opts.titlebgcolor+";'>";g+="<div id='"+this.opts.id+"TopContent' style='position:absolute;left:0px;overflow:hidden;height:"+this.opts.titleheight+"px;text-indent:5px;font-weight:bold;color:"+this.opts.titlefgcolor+";'>";g+=this.opts.title;g+="</div>";g+="</div>";e='<div id="'+this.opts.id+'Content" style="overflow-x:auto;overflow-y:auto;display:block;border:0px;position:absolute;margin:5px;left:0px;top:'+this.opts.titleheight+"px";e+="width:"+(this.opts.width-2*this.opts.borderw)+"px;";e+="height:"+(this.opts.height-2*this.opts.borderw-this.opts.titleheight)+'px;">';e+=this.Content;e+="</div>";f=h+g+e+i;return f};this.MarkComplete=function(e,g){var f=e?"images/tick.png":UI.BlankImgUrl();if(g!==undefined){$("#slidemark_"+g).attr("src",f)}else{$("#"+this.opts.id+"Content").find("img").attr("src",f)}};this.ToggleDock=function(){this.minimized=!this.minimized;UI.Toolbar.Layout()};this.Resize=function(e,g){var i=$("#"+this.opts.id);var f=$("#"+this.opts.id+"Content");if(e){i.width(e-2*this.opts.borderw);f.width(e-2*this.opts.borderw-5)}if(g){i.height(g-2*this.opts.borderw);f.height(g-2*this.opts.borderw-this.opts.titleheight-5)}};this.SetRect=function(e){UI.SlidesPanel().css("top",e.y).css("left",e.x).width(e.w).height(e.h);this.Resize(e.w,e.h)};this.Show=function(){$("#"+this.opts.id).remove();UI.SlidesPanel().append(this.GetHTML());$("#"+this.opts.id).show()};this.Hide=function(){$("#"+this.opts.id).hide()};return this};ReportUI={OnSendReport:function(){Prez.SendReport()},OnFinish:function(){ReportUI.Close();Prez.Close(false)},OnRestart:function(){ReportUI.Close();Prez.Restart()},OnShow:function(){$(document).unbind("reveal.facebox");$.facebox.footer(ReportUI.GetBtns());if(Options.report_method!==undefined&&Options.report_method!=ReportMethod.NONE){$("#SendReportButton").click(function(){ReportUI.OnSendReport()})}$("#ReportRestartButton").click(function(){ReportUI.OnRestart()});$("#ReportFinishButton").click(function(){ReportUI.OnFinish()})},Close:function(){$(document).trigger("close.facebox");Prez.Resume()},GetSummaryInfo:function(){var e=Prez.GetPoints();var b=Prez.GetMaxPoints();var a=Math.ceil(Prez.Session.Elapsed/1000);var f=new Date();var c="<div class='reporthinfo'>";c+="<table width='100%' border='1px' bordercolor='#808080' bordercolordark='#808080' bordercolorlight='#C0C0C0' cellspacing='0px' rules='all' frame='box' cellpadding='0px'>";c+="<tbody>";c+="<tr><td width='30%'>"+Lang.Presentation+"</td><td>"+PrezInfo.Name.quoteHTML()+"</td></tr>";c+="<tr><td>"+Lang.Description+"</td><td>"+PrezInfo.Description.quoteHTML()+"</td></tr>";c+="<tr><td>"+Lang.Date1+"</td><td>"+f.toUTCString()+"</td></tr>";c+="<tr><td>"+Lang.TotalTime+"</td><td>"+Math.floor(a/3600)+" h : "+Math.floor((a%3600)/60)+" m : "+(a%60)+" s</td></tr>";c+="<tr><td>"+Lang.TakenSlides+"</td><td>"+Prez.GetTakenSlideCount()+" / "+Prez.GetSlideCount()+"</td></tr>";c+="<tr><td>"+Lang.TakenInteractions+"</td><td>"+Prez.GetTakenInteractionCount()+" / "+Prez.GetInteractionCount()+"</td></tr>";c+="<tr><td>"+Lang.CorrectCount+"</td><td>"+Prez.GetTakenInteractionCount(Judge.CORRECT)+"</td></tr>";c+="<tr><td>"+Lang.Points+"</td><td>"+e+"/"+b+"</td></tr>";c+="<tr><td>"+Lang.Percentage+"</td><td>"+parseInt(e*100/b)+" %</td></tr>";c+="<tr><td>"+Lang.Result+"</td><td>"+(Prez.GetResult()?Lang.Passed:Lang.Failed)+" - "+Prez.GetRequirements()+"</td></tr>";c+="</tbody></table>";c+="</div><hr>";return c},GetDetailInfo:function(){var d="<div class='reportrinfo'>";d+="<table width='100%' border='1px' bordercolor='#808080' bordercolordark='#808080' bordercolorlight='#C0C0C0' cellspacing='0px' rules='all' frame='box' cellpadding='0px'><thead><tr>";d+="<th width='10%' align='center'>#</th>";d+="<th width='15%' align='center'>"+Lang.SlideIndex+"</th>";d+="<th width='15%' align='center'>ID</th>";d+="<th width='15%' align='center'>"+Lang.Attempts+"</th>";d+="<th width='15%' align='center'>"+Lang.Points+"</th>";d+="<th width='15%' align='center'>"+Lang.MaxPoints+"</th>";d+="<th width='15%' align='center'>"+Lang.Result+"</th>";d+="</tr></thead><tbody>";var b=this.GetReportResult();var c=b.length;for(var e=0;e<c;++e){var a=b[e];d+="<tr>";d+="<td align='center'>"+(e+1)+"</td>";d+="<td align='center'>"+(parseInt(a.slideidx)+1)+"</td>";d+="<td align='center'>"+a.reportid+"</td>";d+="<td align='center'>"+a.attempts+"</td>";d+="<td align='center'>"+a.points+"</td>";d+="<td align='center'>"+a.maxPoints+"</td>";d+="<td align='center'>"+a.judge+"</td>";d+="</tr>"}d+="</tbody></table>";d+="</div>";return d},GetBtns:function(){var a="<div>";a+="<div align='center'>";if(Options.report_method!==undefined&&Options.report_method!=ReportMethod.NONE){a+="<input style='cursor:pointer;' type='button' id='SendReportButton' value='"+Lang.SendReport+"'>"}if(Prez.Session.PMode&(PlayModes.DEMO|PlayModes.PRAC|PlayModes.TUT)){a+="<input style='cursor:pointer;' type='button' id='ReportRestartButton' value='"+Lang.Restart+"'>"}a+="<input style='cursor:pointer;' type='button' id='ReportFinishButton' value='"+Lang.Finish+"'>";a+="</div></div>";return a},GetHTML:function(){var c={w:$(window).innerWidth(),h:$(window).innerHeight()};var b={w:Math.min(600,c.w-80),h:Math.min(450,9*c.h/10-100)};if(b.w<50){b.w=50}if(b.h<50){b.h=50}var a="<div class='reportcontent' style='width:"+b.w+"px; height:"+b.h+"px'>";a+=this.GetSummaryInfo()+this.GetDetailInfo();a+="</div>";return a},Show:function(){var a=this;$(document).bind("reveal.facebox",a.OnShow);$.facebox(this.GetHTML())},GetReportResult:function(){var g=[];var h=Prez.Session.RestoreData.slides;var k=h.length;for(var j=0;j<k;++j){var m=h[j];if(!m){continue}for(var f in m){var l=m[f];if(!l){continue}var n={slideidx:"",reportid:"",attempts:0,judge:"",answers:"",points:0,maxPoints:0,type:"Unknown"};var e=Prez.GetSlideAt(j);var c=e.ctrls;var b=c.length;for(var d=0;d<b;++d){var a=c[d];if(a.id!=f){continue}n.slideidx=j;n.reportid=a.reportid;n.attempts=l.a||0;n.judge=this.GetJudgeString(l.j);n.points=l.p||0;n.maxPoints=Prez.GetCtrlMaxPoints(a);switch(a.kind){case CtrlKind.INPUT:if(a.type==InputUI.MOUSE){n.type=Lang.MouseClick}else{if(a.type==InputUI.KEY){n.type=Lang.KeyStroke}}break;case CtrlKind.TEXTINPUT:n.answers=l.v;n.type=Lang.TextBox;break;case CtrlKind.QUIZ:n.answers=this.GetQuizAnswers(a,l);switch(a.type){case QuizUI.Type.MULTI_RESPONSE:n.type=Lang.MultipleResponse;break;case QuizUI.Type.TRUE_FALSE:n.type=Lang.TrueFalse;break;case QuizUI.Type.MULTI_CHOICE:n.type=Lang.MultipleChoice;break;case QuizUI.Type.SEQUENCE_DRAGDROP:n.type=Lang.Sequence;break;case QuizUI.Type.SINGLELINE_TEXT:n.type=Lang.FillBlank;break;case QuizUI.Type.MULTILINE_TEXT:n.type=Lang.Essay;break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:n.type=Lang.FillMultipleBlank;break;default:break}break;case CtrlKind.BUTTON:n.type=Lang.Button;break;default:break}break}g.push(n)}}return g},GetQuizAnswers:function(c,f){var e=c.ctrls;var b=e.length;var d="";var g;switch(c.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.MULTI_CHOICE:case QuizUI.Type.TRUE_FALSE:for(g=0;g<b;++g){if(e[g].kind!=CtrlKind.ANSWER){continue}if(f.v[e[g].act.id]==true){if(d!=""){d+=", "}d+=e[g].reportid}}break;case QuizUI.Type.SEQUENCE_DRAGDROP:var a={};var j;var h=0;for(g=0;g<b;++g){if(e[g].kind!=CtrlKind.NOTE&&e[g].type!=NoteType.ANSWER){continue}j=f.v[e[g].id];if(j===undefined){continue}a[j]=e[g].reportid;h++}for(g=0;g<h;++g){if(!a[g]){continue}if(d!=""){d+=", "}d+=a[g]}break;
case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:for(g=0;g<b;++g){if(e[g].kind!=CtrlKind.TEXTINPUT){continue}d=f.v[e[g].id];break}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:for(g=0;g<b;++g){if(e[g].kind!=CtrlKind.ANSWER){continue}if(d!=""){d+=", "}d+=e[g].reportid+"."+f.v[e[g].act.id]}break;default:break}return d},GetJudgeString:function(a){if(!a){return"Unknown"}else{if(a==Judge.CORRECT){return Lang.Correct}else{if(a==Judge.WRONG){return Lang.Incorrect}else{if(a==Judge.PARTIAL_CORRECT){return Lang.PartialCorrect}else{if(a==Judge.INCOMPLETE){return Lang.Incomplete}else{if(a==Judge.NEUTRAL){return""}}}}}}return"Unknown"}};
/*!
 * Atomi Ajax Player - UI Implementations
 * Company: Atomi Systems, Inc.
 * http://www.atomisystems.com
 * Modified: 2010/05/06
 */
function APSlider(c){this._dragging=false;this.enabled=true;this.minVal=0;this.maxVal=100;this.val=0;this._width=1;this.handleHW=4;this.handleH=24;this.tooltip="";this.tooltipEnabled=true;this.id=c.attr("id");this.handleId=this.id+"_handle";this.tooltipId=this.id+"_tooltip";this.progressBarId=this.id+"_progress";var b=this;var d='<div id="'+this.progressBarId+'"></div>';c.empty().append(d);$("#"+this.progressBarId).css("position","absolute").css("left","0px").css("top","8px").css("width","0px").css("height","8px");$("#"+this.progressBarId).css("background-color",TemplateParams.ProgressBar2);var e='<div id="'+this.handleId+'" style="position:absolute;top:0px;left:0px;width:8px;height:24px;cursor:pointer;"></div>';c.append(e);var k=document.createElement("canvas");$("#"+this.handleId).get(0).appendChild(k);if(typeof G_vmlCanvasManager!="undefined"){G_vmlCanvasManager.initElement(k)}$(k).attr("width",this.handleHW*2).attr("height",this.handleH);$(k).css("position","absolute").css("top","0px").css("left","0px").css("width",this.handleHW*2).css("height",this.handleH);var n=k.getContext("2d");if(n){var l=0.5;var j=4+0.5;var a=this.handleHW*2-2*l;var m=this.handleH-2*j;var i=Math.min(a,m)/5;n.beginPath();n.moveTo(l+i,j);n.lineTo(l+a-i,j);n.quadraticCurveTo(l+a,j,l+a,j+i);n.lineTo(l+a,j+m-i);n.quadraticCurveTo(l+a,j+m,l+a-i,j+m);n.lineTo(l+i,j+m);n.quadraticCurveTo(l,j+m,l,j+m-i);n.lineTo(l,j+i);n.quadraticCurveTo(l,j,l+i,j);n.closePath();var f=n.createLinearGradient(l,j,l,j+m);f.addColorStop(0,TemplateParams.ButtonBG1);f.addColorStop(1,TemplateParams.ButtonBG2);n.fillStyle=f;n.fill();n.lineWidth=1;n.strokeStyle=TemplateParams.ButtonBorder;n.stroke()}var h='<div 	id="'+this.tooltipId+'" style="display:none;position:absolute;top:-30px;left:150px;width:40px;height:29px;"></div>';c.append(h);$("#"+this.tooltipId).css({"background-image":"url('images/tb_hover.gif')","background-repeat":"no-repeat","font-family":"Serif","font-size":"14px",color:"#656565","text-align":"center","padding-top":"2px"});$("#"+this.handleId).mousedown(function(g){b._StartSlide();g.preventDefault();g.stopPropagation()}).mouseup(function(g){b._StopSlide(g.pageX-$("#"+b.id).offset().left)}).mouseenter(function(){if(b.tooltipEnabled){$("#"+b.tooltipId).show()}}).mouseleave(function(){$("#"+b.tooltipId).hide()});c.mousedown(function(g){b._Seek(g.pageX-$(this).offset().left)})}APSlider.prototype={constructor:APSlider,SetTooltip:function(a){if(a!=this.tooltip){this.tooltip=a;$("#"+this.tooltipId).text(a)}},ShowTooltip:function(a){if(a===undefined){a=true}if(a){$("#"+this.tooltipId).show()}else{$("#"+this.tooltipId).hide()}},GetVal:function(){return this.val},SetVal:function(a){if(this._dragging){return false}if(a<this.minVal){a=this.minVal}else{if(a>this.maxVal){a=this.maxVal}}this.val=a;var b=this._ValToPos(a)||0;this._UpdateHandle(b);return true},GetMinVal:function(){return this.minVal},SetMinVal:function(a){this.minVal=a},GetMaxVal:function(){return this.maxVal},SetMaxVal:function(a){this.maxVal=a},GetWidth:function(){return this._width},SetWidth:function(a){this._width=a;$("#"+this.id).css("width",a+"px");var b=this._ValToPos(this.val)||0;this._UpdateHandle(b)},SetListener:function(b,a,c){this[b]={listener:a,methodName:c}},Enable:function(a){if(this.enabled&&!a){this._StopSlide()}this.enabled=a;$("#"+this.handleId).css("cursor",a?"pointer":"default")},EnableTooltip:function(a){this.tooltipEnabled=a},_UpdateHandle:function(a){$("#"+this.progressBarId).css("width",a+"px");$("#"+this.handleId).css("left",(a-this.handleHW)+"px");$("#"+this.tooltipId).css("left",(a-20)+"px")},_StartSlide:function(){this._StopSlide();if(this.enabled){var a=this;this._dragging=true;$("#"+this.id).mousemove(function(b){a._Seek(b.pageX-$(this).offset().left)})}},_StopSlide:function(a){if(this._dragging){$("#"+this.id).unbind("mousemove");this._dragging=false;this._Seek(a)}},_Seek:function(c){if(this.enabled){if(c<0){c=0}else{if(c>this._width){c=this._width}}var a=this._PosToVal(c),b=false;if(!isNaN(a)){if(a!=this.val){if(!this.onChanging||this.onChanging.listener[this.onChanging.methodName](this,this.val,a)!==false){this.val=a;b=true}}}if(!this._dragging&&!b){c=this._ValToPos(this.val)||0}this._UpdateHandle(c)}},_PosToVal:function(b){var a=Math.round(this.minVal+b*(this.maxVal-this.minVal)/this._width);if(a<this.minVal){a=this.minVal}else{if(a>this.maxVal){a=this.maxVal}}return a},_ValToPos:function(b){var a=Math.round((b-this.minVal)*this._width/(this.maxVal-this.minVal));if(a<0){a=0}else{if(a>this._width){a=this._width}}return a}};var ButtonStates={NORMAL:1,HOVERING:2,SELECTED:3};function APToolbar(o){var n=24;var h=600;var g=0;var f=0;var l=false;var d=50;var c="APToolbar";var m=28;var e=18;var b=(n-e)/2;var a=(typeof G_vmlCanvasManager!="undefined");var k=2;var j=5;var i=10;this.options={sliderMin:0,sliderMax:100,sliderVal:0};$.extend(this.options,o);this.GetHTML=function(){var p="<div id="+c+" style='position:absolute;top:0px;left:0px;z-index:0'>	</div>";return p};this._CreateTool=function(p,y,A,s,B,x){var t=document.createElement("div");y.appendChild(t);var v=$(t);v.attr("id",p).attr("title",x);v.css("width",A).css("height",s);var z=this;for(var r=ButtonStates.NORMAL;r<=ButtonStates.SELECTED;++r){var u=document.createElement("canvas");t.appendChild(u);if(a){G_vmlCanvasManager.initElement(u)}$(u).attr("width",A).attr("height",s);$(u).css("position","absolute").css("top","0px").css("left","0px").css("width",A).css("height",s);B.call(z,u,r);if(r==ButtonStates.NORMAL){$(u).css("visibility","visible")}else{$(u).css("visibility","hidden")}}var q=document.createElement("div");t.appendChild(q);$(q).css("position","absolute").css("top","0px").css("left","0px").css("width",A).css("height",s);v.mouseleave(function(){$("#"+p+" > canvas").each(function(w){if(w+ButtonStates.NORMAL==ButtonStates.NORMAL){$(this).css("visibility","visible")}else{$(this).css("visibility","hidden")}return true})}).mouseenter(function(){$("#"+p+" > canvas").each(function(w){if(w+ButtonStates.NORMAL==ButtonStates.HOVERING){$(this).css("visibility","visible")}else{$(this).css("visibility","hidden")}return true})}).mouseup(function(){$("#"+p+" > canvas").each(function(w){if(w+ButtonStates.NORMAL==ButtonStates.HOVERING){$(this).css("visibility","visible")}else{$(this).css("visibility","hidden")}return true})}).mousedown(function(){$("#"+p+" > canvas").each(function(w){if(w+ButtonStates.NORMAL==ButtonStates.SELECTED){$(this).css("visibility","visible")}else{$(this).css("visibility","hidden")}return true})})};this._InitToolbar=function(){var s=document.getElementById(c);var q=document.createElement("canvas");s.appendChild(q);if(a){G_vmlCanvasManager.initElement(q)}$(q).attr("id","tbbackground").attr("width",h).attr("height",n);$(q).css("width",h).css("height",n);this._DrawToolbarBackground(q);this._CreateTool("btfirst",s,m,e,this._DrawFirstButton,Lang.FirstSlide);this._CreateTool("btprev",s,m,e,this._DrawPrevButton,Lang.PreviousSlide);this._CreateTool("btplay",s,m,e,this._DrawPlayButton,Lang.PlayPrez);this._CreateTool("btpause",s,m,e,this._DrawPauseButton,Lang.PausePrez);this._CreateTool("btnext",s,m,e,this._DrawNextButton,Lang.NextSlide);this._CreateTool("btlast",s,m,e,this._DrawLastButton,Lang.LastSlide);
var r=document.createElement("div");$(r).attr("id","slider_rail");$(r).css("width",10).css("height",n).css("background",'url("images/blank.gif") repeat-x');s.appendChild(r);this.slider=new APSlider($("#slider_rail"));this.slider.SetMinVal(this.options.sliderMin);this.slider.SetMaxVal(this.options.sliderMax);this.slider.SetVal(this.options.sliderVal);var p=document.createElement("div");$(p).attr("id","volume_slider").attr("title",Lang.AdjustVolume);$(p).css("width",53).css("height",n).css("background",'url("images/blank.gif") repeat-x');s.appendChild(p);this.volume_slider=new APSlider($("#volume_slider"));this.volume_slider.SetMinVal(0);this.volume_slider.SetMaxVal(100);this.volume_slider.SetVal(0);this.volume_slider.EnableTooltip(false);this._CreateTool("btsound",s,m,e,this._DrawSoundButton,Lang.Mute);this._CreateTool("btmute",s,m,e,this._DrawMuteButton,Lang.Unmute);this._CreateTool("btclosedcaption",s,m,e,this._DrawClosedCaptionButton,Lang.HideCC);this._CreateTool("btclosedcaption_hide",s,m,e,this._DrawClosedCaptionHideButton,Lang.ShowCC);this._CreateTool("btinfo",s,m,e,this._DrawInfoButton,Lang.About);this._CreateTool("btslidelist",s,m,e,this._DrawSlideListButton,Lang.ShowSlideList);this._CreateTool("btexit",s,m,e,this._DrawExitButton,Lang.ClosePrez)};this._SetToolbarWidth=function(p){var q=4*j+10*m+7*k+2*i+d+20;if(p<q){p=q}h=p;this._LayoutInternal()};this._SetToolbarPosition=function(p,q){g=p;f=q;this._LayoutInternal()};this._LayoutInternal=function(){if(!l){return}$("#"+c).css("left",g).css("top",f);var q=j;$("#tbbackground").attr("width",h).attr("height",n);$("#tbbackground").css("position","absolute").css("top","0px").css("left","0px").css("width",h).css("height",n);this._DrawToolbarBackground($("#tbbackground").get(0));$("#btfirst").css("position","absolute").css("top",b).css("left",q).css("width",m).css("height",e);q+=(m+k);$("#btprev").css("position","absolute").css("top",b).css("left",q).css("width",m).css("height",e);q+=(m+k);$("#btplay").css("position","absolute").css("top",b).css("left",q).css("width",m).css("height",e);$("#btpause").css("position","absolute").css("top",b).css("left",q).css("width",m).css("height",e);q+=(m+k);$("#btnext").css("position","absolute").css("top",b).css("left",q).css("width",m).css("height",e);q+=(m+k);$("#btlast").css("position","absolute").css("top",b).css("left",q).css("width",m).css("height",e);q+=(m+i);var p=(h-(5*m+3*k+3*j+d)-i)-q;this.slider.SetWidth(p);$("#slider_rail").css("position","absolute").css("top","0px").css("left",q).css("width",p).css("height",n);q+=(p+i);$("#btsound").css("position","absolute").css("top",b).css("left",q).css("width",m).css("height",e);$("#btmute").css("position","absolute").css("top",b).css("left",q).css("width",m).css("height",e);q+=(m+j);this.volume_slider.SetWidth(d);$("#volume_slider").css("position","absolute").css("top","0px").css("left",q).css("width",d).css("height",n);q+=(d+j);$("#btclosedcaption").css("position","absolute").css("top",b).css("left",q).css("width",m).css("height",e);$("#btclosedcaption_hide").css("position","absolute").css("top",b).css("left",q).css("width",m).css("height",e);q+=(m+k);$("#btinfo").css("position","absolute").css("top",b).css("left",q).css("width",m).css("height",e);q+=(m+k);$("#btslidelist").css("position","absolute").css("top",b).css("left",q).css("width",m).css("height",e);q+=(m+k);$("#btexit").css("position","absolute").css("top",b).css("left",q).css("width",m).css("height",e)};this._DrawButtonBackground=function(s,r,w,t,q,v){r=r+0.5;w=w+0.5;t=t-1;q=q-1;var p=Math.min(t,q)/5;s.beginPath();s.moveTo(r+p,w);s.lineTo(r+t-p,w);s.quadraticCurveTo(r+t,w,r+t,w+p);s.lineTo(r+t,w+q-p);s.quadraticCurveTo(r+t,w+q,r+t-p,w+q);s.lineTo(r+p,w+q);s.quadraticCurveTo(r,w+q,r,w+q-p);s.lineTo(r,w+p);s.quadraticCurveTo(r,w,r+p,w);s.closePath();var u=s.createLinearGradient(r,w,r,w+q);u.addColorStop(0,TemplateParams.ButtonBG1);u.addColorStop(1,TemplateParams.ButtonBG2);s.fillStyle=u;s.fill();s.lineWidth=1;if(v=="undefined"){s.strokeStyle=TemplateParams.ButtonBorder}else{if(v==ButtonStates.HOVERING){s.strokeStyle=TemplateParams.ButtonBorderHover}else{if(v==ButtonStates.SELECTED){s.strokeStyle=TemplateParams.ButtonBorderSelected}else{s.strokeStyle=TemplateParams.ButtonBorder}}}s.stroke()};this._DrawToolbarBackground=function(t){var q=t.getContext("2d");if(q){var s=q.createLinearGradient(0,0,0,n);s.addColorStop(0,TemplateParams.ToolbarBG1);s.addColorStop(1,TemplateParams.ToolbarBG2);q.fillStyle=s;q.fillRect(0,0,h,n);q.strokeStyle=TemplateParams.ToolbarBorder;q.lineWidth=1;q.strokeRect(0.5,0.5,h-1,n-1);var r=5*m+4*k+j+i;var p=(h-(5*m+3*k+3*j+d)-i)-r;q.fillStyle=TemplateParams.ProgressBar1;q.fillRect(r,8,p,n-16);r+=(p+i+m+j);q.fillStyle=TemplateParams.ProgressBar1;q.fillRect(r,8,d,n-16)}};this._DrawFirstButton=function(r,q){var p=r.getContext("2d");if(p){this._DrawButtonBackground(p,0,0,m,e,q);p.beginPath();p.moveTo(8,3);p.lineTo(12,3);p.lineTo(12,e-3);p.lineTo(8,e-3);p.lineTo(8,3);p.closePath();p.fillStyle=TemplateParams.ButtonIcon;p.fill();p.beginPath();p.moveTo(20,3);p.lineTo(10,e/2);p.lineTo(20,e-3);p.lineTo(20,3);p.closePath();p.fillStyle=TemplateParams.ButtonIcon;p.fill()}};this._DrawPrevButton=function(r,q){var p=r.getContext("2d");if(p){this._DrawButtonBackground(p,0,0,m,e,q);p.beginPath();p.moveTo(14,3);p.lineTo(6,e/2);p.lineTo(14,e-3);p.closePath();p.fillStyle=TemplateParams.ButtonIcon;p.fill();p.beginPath();p.moveTo(20,3);p.lineTo(12,e/2);p.lineTo(20,e-3);p.closePath();p.fillStyle=TemplateParams.ButtonIcon;p.fill()}};this._DrawPlayButton=function(r,q){var p=r.getContext("2d");if(p){this._DrawButtonBackground(p,0,0,m,e,q);p.beginPath();p.moveTo(10,3);p.lineTo(22,e/2);p.lineTo(10,15);p.closePath();p.fillStyle=TemplateParams.ButtonIcon;p.fill()}};this._DrawPauseButton=function(r,q){var p=r.getContext("2d");if(p){this._DrawButtonBackground(p,0,0,m,e,q);p.beginPath();p.moveTo(8,3);p.lineTo(12,3);p.lineTo(12,e-3);p.lineTo(8,e-3);p.lineTo(8,3);p.moveTo(16,3);p.lineTo(20,3);p.lineTo(20,e-3);p.lineTo(16,e-3);p.lineTo(16,3);p.closePath();p.fillStyle=TemplateParams.ButtonIcon;p.fill()}};this._DrawNextButton=function(r,q){var p=r.getContext("2d");if(p){this._DrawButtonBackground(p,0,0,m,e,q);p.beginPath();p.moveTo(8,3);p.lineTo(16,e/2);p.lineTo(8,e-3);p.closePath();p.fillStyle=TemplateParams.ButtonIcon;p.fill();p.beginPath();p.moveTo(14,3);p.lineTo(22,e/2);p.lineTo(14,e-3);p.closePath();p.fillStyle=TemplateParams.ButtonIcon;p.fill()}};this._DrawLastButton=function(r,q){var p=r.getContext("2d");if(p){this._DrawButtonBackground(p,0,0,m,e,q);p.beginPath();p.moveTo(8,3);p.lineTo(18,e/2);p.lineTo(8,e-3);p.closePath();p.fillStyle=TemplateParams.ButtonIcon;p.fill();p.beginPath();p.moveTo(16,3);p.lineTo(20,3);p.lineTo(20,e-3);p.lineTo(16,e-3);p.lineTo(16,3);p.closePath();p.fillStyle=TemplateParams.ButtonIcon;p.fill()}};this._DrawVolumeHandle=function(r,q){var p=r.getContext("2d");if(p){this._DrawButtonBackground(p,0,0,10,e,q)}};this._DrawSoundButton=function(r,q){var p=r.getContext("2d");if(p){this._DrawButtonBackground(p,0,0,m,e,q);p.beginPath();p.moveTo(8,6);p.lineTo(12,6);p.lineTo(16,3);p.lineTo(16,e-3);p.lineTo(12,e-6);p.lineTo(8,e-6);p.closePath();p.fillStyle=TemplateParams.ButtonIcon;p.fill();p.beginPath();p.moveTo(18,7);p.quadraticCurveTo(20,e/2,18,e-7);p.moveTo(18,3);p.quadraticCurveTo(26,e/2,18,e-3);p.strokeStyle=TemplateParams.ButtonIcon;p.lineWidth=1;p.stroke()}};this._DrawMuteButton=function(r,q){var p=r.getContext("2d");if(p){this._DrawButtonBackground(p,0,0,m,e,q);p.beginPath();p.moveTo(8,6);p.lineTo(12,6);p.lineTo(16,3);p.lineTo(16,e-3);p.lineTo(12,e-6);p.lineTo(8,e-6);p.closePath();p.fillStyle=TemplateParams.ButtonIcon;p.fill();p.beginPath();p.moveTo(7,2);p.lineTo(21,16);p.moveTo(21,2);p.lineTo(7,16);p.strokeStyle="rgb(255, 0, 80)";p.lineWidth=1;p.stroke()}};this._DrawClosedCaptionButton=function(r,q){var p=r.getContext("2d");if(p){this._DrawButtonBackground(p,0,0,m,e,q);p.strokeStyle=TemplateParams.ButtonIcon;p.lineWidth=4;p.lineJoin="round";p.beginPath();
p.moveTo(12,6);p.lineTo(8,6);p.lineTo(8,e-6);p.lineTo(12,e-6);p.stroke();p.beginPath();p.moveTo(20,6);p.lineTo(16,6);p.lineTo(16,e-6);p.lineTo(20,e-6);p.stroke()}};this._DrawClosedCaptionHideButton=function(r,q){var p=r.getContext("2d");if(p){this._DrawButtonBackground(p,0,0,m,e,q);p.strokeStyle=TemplateParams.ButtonIcon;p.lineWidth=4;p.lineJoin="round";p.beginPath();p.moveTo(12,6);p.lineTo(8,6);p.lineTo(8,e-6);p.lineTo(12,e-6);p.stroke();p.beginPath();p.moveTo(20,6);p.lineTo(16,6);p.lineTo(16,e-6);p.lineTo(20,e-6);p.stroke();p.beginPath();p.moveTo(7,2);p.lineTo(21,16);p.moveTo(21,2);p.lineTo(7,16);p.strokeStyle="rgb(255, 0, 80)";p.lineWidth=1;p.stroke()}};this._DrawInfoButton=function(r,q){var p=r.getContext("2d");if(p){this._DrawButtonBackground(p,0,0,m,e,q);p.strokeStyle=TemplateParams.ButtonIcon;p.lineWidth=4;p.beginPath();p.moveTo(14,6);p.lineTo(14,e-4);p.stroke();p.beginPath();p.moveTo(12,2);p.lineTo(16,2);p.lineTo(16,5);p.lineTo(12,5);p.closePath();p.fillStyle=TemplateParams.ButtonIcon;p.fill()}};this._DrawSlideListButton=function(r,q){var p=r.getContext("2d");if(p){this._DrawButtonBackground(p,0,0,m,e,q);p.strokeStyle=TemplateParams.ButtonIcon;p.lineWidth=1;p.beginPath();p.moveTo(6.5,2.5);p.lineTo(m-6.5,2.5);p.lineTo(m-6.5,e-2.5);p.lineTo(6.5,e-2.5);p.lineTo(6.5,2.5);p.moveTo(9.5,5.5);p.lineTo(m-9.5,5.5);p.moveTo(9.5,8.5);p.lineTo(m-9.5,8.5);p.moveTo(9.5,11.5);p.lineTo(m-9.5,11.5);p.closePath();p.stroke()}};this._DrawExitButton=function(r,q){var p=r.getContext("2d");if(p){this._DrawButtonBackground(p,0,0,m,e,q);p.strokeStyle=TemplateParams.ButtonIcon;p.lineWidth=4;p.beginPath();p.moveTo(9,4);p.lineTo(19,14);p.moveTo(19,4);p.lineTo(9,14);p.closePath();p.stroke()}};this.SetListener=function(q,p,r){switch(q){case"onSeeking":this.slider.SetListener("onChanging",p,r);break;case"onVolumeChanging":this.volume_slider.SetListener("onChanging",p,r);break}};this.GetSliderPosition=function(){return this.slider.GetVal()};this.SetSliderPosition=function(p){return this.slider.SetVal(p)};this.SetSliderTip=function(p){this.slider.SetTooltip(p)};this.GetVolumeValue=function(){return this.volume_slider.GetVal()};this.SetVolumeValue=function(p){return this.volume_slider.SetVal(p)};this.SetPause=function(p){if(p){$("#btplay").show();$("#btpause").hide()}else{$("#btplay").hide();$("#btpause").show()}};this.SetMute=function(p){if(p){$("#btmute").show();$("#btsound").hide()}else{$("#btmute").hide();$("#btsound").show()}};this.SetCCaption=function(p){if(p){$("#btclosedcaption").show();$("#btclosedcaption_hide").hide()}else{$("#btclosedcaption").hide();$("#btclosedcaption_hide").show()}};this.UpdateState=function(){if(!l){return}this.SetPause(!Prez.IsRunning());if(Prez.prjSldUI){this.SetSliderPosition(Prez.prjSldUI.ts)}this.SetSliderTip(Prez.Session.SlideIndex+1);this.SetVolumeValue(Prez.GetVolume(false));this.SetMute(Prez.IsMuted());this.SetCCaption(ClosedCaptionUI.IsShown());if((UI.SlideList!=null)&&(UI.SlideList.minimized==false)){$("#btslidelist").attr("title",Lang.HideSlideList)}else{$("#btslidelist").attr("title",Lang.ShowSlideList)}};this.Show=function(){$("#"+c).remove();UI.ViewPort().append(this.GetHTML());this._InitToolbar();l=true;this._LayoutInternal();this._InitHandlers();$("#"+c).show()};this.Hide=function(){$("#"+c).hide()};this.Close=function(){l=false;$("#"+c).remove()};this.Layout=function(){var p=PrezInfo.ViewPort.width;var t=PrezInfo.ViewPort.height;var r={w:$(window).innerWidth(),h:$(window).innerHeight()};var s={x:0,y:0,w:r.w,h:r.h};if(s.w>p){s.x=parseInt((s.w-p)/2);s.w=p}else{p=s.w}if(s.h>t+n){s.h=t+n}else{t=s.h-n}var q={x:0,y:0,w:p,h:t};var u={x:0,y:0,w:0,h:0};if(UI.SlideList){if((Prez.Session.PMode==PlayModes.DEMO)||(Prez.Session.PMode==PlayModes.TUT)){switch(TemplateParams.SlideListPos){case SlideListPos.LEFT:if(UI.SlideList.minimized){u.w=UI.SlideList.MinSize.w;u.h=UI.SlideList.MinSize.h}else{u.w=parseInt(p*TemplateParams.SlideListRatio/100);u.h=t}s.x=Math.max(s.x-parseInt(u.w/2),0);s.w=Math.min(s.w+u.w,r.w);q.x=u.w;q.w=Math.min(s.w-u.w,r.w-u.w);q.h=t;break;case SlideListPos.RIGHT:if(UI.SlideList.minimized){u.w=UI.SlideList.MinSize.w;u.h=UI.SlideList.MinSize.h}else{u.w=parseInt(p*TemplateParams.SlideListRatio/100);u.h=t}s.x=Math.max(s.x-parseInt(u.w/2),0);s.w=Math.min(s.w+u.w,r.w);q.w=Math.min(s.w-u.w,r.w-u.w);q.h=t;u.x=q.w;break;case SlideListPos.TOP:u.w=s.w;if(UI.SlideList.minimized){u.h=UI.SlideList.MinSize.h}else{u.h=parseInt(t*TemplateParams.SlideListRatio/100)}s.h=Math.min(s.h+u.h,r.h);q.y=u.h;q.w=s.w;q.h=Math.min(s.h-u.h-n,r.h-u.h-n);break;case SlideListPos.BOTTOM:u.w=s.w;if(UI.SlideList.minimized){u.h=UI.SlideList.MinSize.h}else{u.h=parseInt(t*TemplateParams.SlideListRatio/100)}s.h=Math.min(s.h+u.h,r.h);q.w=s.w;q.h=Math.min(s.h-u.h-n,r.h-u.h-n);u.y=q.h;break}}}UI.ViewPort().css("top",s.y).css("left",s.x).width(s.w).height(s.h);UI.Stage().css("top",q.y).css("left",q.x).width(q.w).height(q.h);p=PrezInfo.ViewPort.width;t=PrezInfo.ViewPort.height;if(($.browser.webkit||$.browser.opera)&&(q.w>=p||q.h>=t)){UI.Canvas().width(q.w-30).height(q.h-30)}UI.Canvas().width(p).height(t);if(UI.SlideList){UI.SlideList.SetRect(u)}$("#"+c).css("z-index",ZIndexBase.Dialog);this._SetToolbarPosition(0,s.h-n);this._SetToolbarWidth(s.w);this.UpdateState()};this._InitHandlers=function(){$("#btfirst").click(function(){if((Prez.Session.PMode==PlayModes.DEMO)||(Prez.Session.PMode==PlayModes.TUT)){Prez.GoFirst()}});$("#btprev").click(function(){if((Prez.Session.PMode==PlayModes.DEMO)||(Prez.Session.PMode==PlayModes.TUT)){Prez.GoPrev()}});$("#btplay").click(function(){if((Prez.Session.PMode==PlayModes.DEMO)||(Prez.Session.PMode==PlayModes.TUT)){Prez.TogglePause()}});$("#btpause").click(function(){if((Prez.Session.PMode==PlayModes.DEMO)||(Prez.Session.PMode==PlayModes.TUT)){Prez.TogglePause()}});$("#btnext").click(function(){if((Prez.Session.PMode==PlayModes.DEMO)||(Prez.Session.PMode==PlayModes.TUT)){Prez.GoNext()}});$("#btlast").click(function(){if((Prez.Session.PMode==PlayModes.DEMO)||(Prez.Session.PMode==PlayModes.TUT)){Prez.GoLast()}});$("#btsound").click(function(){Prez.Mute(true)});$("#btmute").click(function(){Prez.Mute(false)});$("#btclosedcaption").click(function(){Prez.ToggleClosedCaption()});$("#btclosedcaption_hide").click(function(){Prez.ToggleClosedCaption()});$("#btinfo").click(function(){UI.ShowAbout()});$("#btslidelist").click(function(){if((Prez.Session.PMode==PlayModes.DEMO)||(Prez.Session.PMode==PlayModes.TUT)){UI.ToggleSlideList()}});$("#btexit").click(function(){Prez.Close(true)})};this.UpdateTemplateParamsChanged=function(){this.Show();this.Layout()}}APToolbar.GetImages=function(a){a.push("images/tb_hover.gif")};